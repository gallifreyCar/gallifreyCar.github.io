<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>PromQL指南 | Gallifrey的计算机学习日记</title><meta name="keywords" content="Prometheus"><meta name="author" content="Gallifrey"><meta name="copyright" content="Gallifrey"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="声明本文是个人对Querying basics | Prometheus的翻译、整理和小部分扩展，翻译内容基于Prometheus版本: 2.43 本篇翻译的目的是为了帮助更多的读者了解Prometheus官方文档中的内容，同时为中文用户提供更便利地阅读体验 Prometheus的国际化工作在发文截止前（2023-04-24 11:22:20）还处于讨论阶段，所以我没有向官方提交PR，详情请看ht">
<meta property="og:type" content="article">
<meta property="og:title" content="PromQL指南">
<meta property="og:url" content="https://gallifrey.asia/posts/278d3938691c/index.html">
<meta property="og:site_name" content="Gallifrey的计算机学习日记">
<meta property="og:description" content="声明本文是个人对Querying basics | Prometheus的翻译、整理和小部分扩展，翻译内容基于Prometheus版本: 2.43 本篇翻译的目的是为了帮助更多的读者了解Prometheus官方文档中的内容，同时为中文用户提供更便利地阅读体验 Prometheus的国际化工作在发文截止前（2023-04-24 11:22:20）还处于讨论阶段，所以我没有向官方提交PR，详情请看ht">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2023-04-26T07:47:01.000Z">
<meta property="article:modified_time" content="2023-04-26T07:47:01.000Z">
<meta property="article:author" content="Gallifrey">
<meta property="article:tag" content="Prometheus">
<meta name="twitter:card" content="summary"><link rel="shortcut icon" href="/img/G.png"><link rel="canonical" href="https://gallifrey.asia/posts/278d3938691c/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c230ce935268bf5d115ac7b937399330";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"3MS49WD3QJ","apiKey":"6f663f260703f2b756d1c06b756e7611","indexName":"GAS","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'PromQL指南',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-04-26 15:47:01'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script src="https://widget.qweather.net/simple/static/js/he-simple-common.js?v=2.0"></script><script async src="/js/weather.js"></script><script src="https://cdn.jsdelivr.net/npm/echarts@4.9.0/dist/echarts.min.js"></script><script src="https://cdn.jsdelivr.net/npm/echarts@4.9.0/dist/echarts.min.js"></script><script src="https://cdn.jsdelivr.net/npm/echarts@4.9.0/map/js/china.js"></script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-footer-beautify@1.0.0/lib/runtime.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Gallifrey的计算机学习日记" type="application/atom+xml">
</head><body><div id="loading-box"><div class="bb8-loadingWarp"><div class="loading-bb8"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/shizi.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">85</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/steam/"><i class="fa-fw fab fa-steam"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-street-view"></i><span> 访客</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-globe"></i><span> 镜像</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="https://gallifrey.asia"><i class="fa-fw fas fa-globe-asia"></i><span> 国内镜像</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gallifreycar.github.io"><i class="fa-fw fas fa-globe-americas"></i><span> 国外镜像</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/toyhouse/"><i class="fa-fw fas fa-robot"></i><span> 模型屋</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Gallifrey的计算机学习日记</a><div id="he-plugin-simple"></div></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/steam/"><i class="fa-fw fab fa-steam"></i><span> 游戏</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/census/"><i class="fa-fw fas fa-street-view"></i><span> 访客</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);" rel="external nofollow noreferrer"><i class="fa-fw fas fa-globe"></i><span> 镜像</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="https://gallifrey.asia"><i class="fa-fw fas fa-globe-asia"></i><span> 国内镜像</span></a></li><li><a class="site-page child" target="_blank" rel="noopener external nofollow noreferrer" href="https://gallifreycar.github.io"><i class="fa-fw fas fa-globe-americas"></i><span> 国外镜像</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/toyhouse/"><i class="fa-fw fas fa-robot"></i><span> 模型屋</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">PromQL指南</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-04-26T07:47:01.000Z" title="发表于 2023-04-26 15:47:01">2023-04-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-04-26T07:47:01.000Z" title="更新于 2023-04-26 15:47:01">2023-04-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Prometheus/">Prometheus</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>91分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="PromQL指南"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h2><p>本文是个人对<a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/basics/">Querying basics | Prometheus</a>的翻译、整理和小部分扩展，翻译内容基于Prometheus版本: 2.43</p>
<p>本篇翻译的目的是为了帮助更多的读者了解Prometheus官方文档中的内容，同时为中文用户提供更便利地阅读体验</p>
<p>Prometheus的国际化工作在发文截止前（2023-04-24 11:22:20）还处于讨论阶段，所以我没有向官方提交PR，详情请看<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/prometheus/docs/issues/2151。">https://github.com/prometheus/docs/issues/2151。</a></p>
<p>如有任何版权问题或翻译错误，请您通过电子邮件联系我：<a href="mailto:956465331@qq.com" rel="external nofollow noreferrer">956465331@qq.com</a>或：<a href="mailto:ufovsmba@gamil.com" rel="external nofollow noreferrer">ufovsmba@gmail.com</a>。</p>
<h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>Prometheus提供了一种称为PromQL(Prometheus Query Language)的函数式查询语言，让我们可以在真实的时间查询和整合时间序列数据。表达式的结果不单单可以在Prometheus表达式浏览器中表示为图表，表格数据，还能通过<a href="#HTTP-API">HTTP API</a>被外部使用。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p>本文档仅供参考，对于学习，可能从几个<a href="#示例">示例</a>入手会更简单</p>
<h3 id="表达式语言数据类型"><a href="#表达式语言数据类型" class="headerlink" title="表达式语言数据类型"></a>表达式语言数据类型</h3><p>在Prometheus的表达式中，一个表达式或者子表达式可以评定为四种类型中的其中一种：</p>
<ul>
<li><strong>Instant vector(即使向量)</strong> - 一组时间序列，每个时间序列包含一个样本，所有样本共享相同的时间戳</li>
<li><strong>Range vector(范围向量)</strong> - 一组时间序列，包含每个时间序列随时间变化的数据点范围</li>
<li><strong>Scalar(标量)</strong> - 简单的浮点数值</li>
<li><strong>String(字符串)</strong> - 简单的字符串值; 目前未使用</li>
</ul>
<p>根据用例的不一样（即当图表化与显示表达式输出时）,只有其中的一些类型是作为用户指定表达式的结果合法的。例如，返回instant vector的表达式是唯一可以直接绘制图表的类型。</p>
<p><em>Notes about the experimental native histograms:</em></p>
<ul>
<li>Ingesting native histograms has to be enabled via a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/feature_flags/#native-histograms">feature flag</a>.</li>
<li>Once native histograms have been ingested into the TSDB (and even after disabling the feature flag again), both instant vectors and range vectors may now contain samples that aren’t simple floating point numbers (float samples) but complete histograms (histogram samples). A vector may contain a mix of float samples and histogram samples.</li>
</ul>
<h3 id="字面量-Literals"><a href="#字面量-Literals" class="headerlink" title="字面量(Literals)"></a>字面量(Literals)</h3><h4 id="字符串字面量-String-literals"><a href="#字符串字面量-String-literals" class="headerlink" title="字符串字面量(String literals)"></a>字符串字面量(String literals)</h4><p>字符串可以用单引号、双引号或反引号表示为字面量。</p>
<p>PromQL 遵循 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://golang.org/ref/spec#String_literals">Go的转义规则</a>。在单引号或双引号中，反斜杠开始转义序列，可能后跟 <code>a</code>、<code>b</code>、<code>f</code>、<code>n</code>、<code>r</code>、<code>t</code>、<code>v</code> 或<code>\</code>。可以使用八进制（<code>\nnn</code>）或十六进制（<code>\xnn</code>、<code>\unnnn</code> 和 <code>\Unnnnnnnn</code>）提供特定字符。</p>
<p>反引号内不处理转义。与 Go 不同，Prometheus 不会在反引号内丢弃换行符。</p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;this is a string&quot;</span><br><span class="line">&#x27;these are unescaped: \n \\ \t&#x27;</span><br><span class="line">`these are not unescaped: \n &#x27; &quot; \t</span><br></pre></td></tr></table></figure>
<h4 id="浮点字面量-Float-literals"><a href="#浮点字面量-Float-literals" class="headerlink" title="浮点字面量(Float literals)"></a>浮点字面量(Float literals)</h4><p>浮点数值标量可以按这样格式写为数据或者浮点数（空格只是为了更好的可读性）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[-+]?(</span><br><span class="line">      [0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?</span><br><span class="line">    | 0[xX][0-9a-fA-F]+</span><br><span class="line">    | [nN][aA][nN]</span><br><span class="line">    | [iI][nN][fF]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">23</span><br><span class="line">-2.43</span><br><span class="line">3.4e-9</span><br><span class="line">0x8f</span><br><span class="line">-Inf</span><br><span class="line">NaN</span><br></pre></td></tr></table></figure>
<h3 id="Time-series-Selectors"><a href="#Time-series-Selectors" class="headerlink" title="Time series Selectors"></a>Time series Selectors</h3><h4 id="Instant-vector-selectors"><a href="#Instant-vector-selectors" class="headerlink" title="Instant vector selectors"></a>Instant vector selectors</h4><p>Instant vector selectors allow the selection of a set of time series and a single sample value for each at a given timestamp (instant): in the simplest form, only a metric name is specified. This results in an instant vector containing elements for all time series that have this metric name.</p>
<p>This example selects all time series that have the metric name:<code>http_requests_total</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total</span><br></pre></td></tr></table></figure>
<p>It is possible to filter these time series further by appending a comma separated list of label matchers in curly braces ().<code>&#123;&#125;</code></p>
<p>This example selects only those time series with the metric name that also have the label set to and their label set to :<code>http_requests_total``job``prometheus``group``canary</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;job=&quot;prometheus&quot;,group=&quot;canary&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>It is also possible to negatively match a label value, or to match label values against regular expressions. The following label matching operators exist:</p>
<ul>
<li><code>=</code>: Select labels that are exactly equal to the provided string.</li>
<li><code>!=</code>: Select labels that are not equal to the provided string.</li>
<li><code>=~</code>: Select labels that regex-match the provided string.</li>
<li><code>!~</code>: Select labels that do not regex-match the provided string.</li>
</ul>
<p>Regex matches are fully anchored. A match of is treated as .<code>env=~&quot;foo&quot;``env=~&quot;^foo$&quot;</code></p>
<p>For example, this selects all time series for , , and environments and HTTP methods other than .<code>http_requests_total``staging``testing``development``GET</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;environment=~&quot;staging|testing|development&quot;,method!=&quot;GET&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>Label matchers that match empty label values also select all time series that do not have the specific label set at all. It is possible to have multiple matchers for the same label name.</p>
<p>Vector selectors must either specify a name or at least one label matcher that does not match the empty string. The following expression is illegal:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;job=~&quot;.*&quot;&#125; # Bad!</span><br></pre></td></tr></table></figure>
<p>In contrast, these expressions are valid as they both have a selector that does not match empty label values.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;job=~&quot;.+&quot;&#125;              # Good!</span><br><span class="line">&#123;job=~&quot;.*&quot;,method=&quot;get&quot;&#125; # Good!</span><br></pre></td></tr></table></figure>
<p>Label matchers can also be applied to metric names by matching against the internal label. For example, the expression is equivalent to . Matchers other than (, , ) may also be used. The following expression selects all metrics that have a name starting with :<code>__name__``http_requests_total``&#123;__name__=&quot;http_requests_total&quot;&#125;``=``!=``=~``!~``job:</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;__name__=~&quot;job:.*&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>The metric name must not be one of the keywords , , , and . The following expression is illegal:<code>bool``on``ignoring``group_left``group_right</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">on&#123;&#125; # Bad!</span><br></pre></td></tr></table></figure>
<p>A workaround for this restriction is to use the label:<code>__name__</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;__name__=&quot;on&quot;&#125; # Good!</span><br></pre></td></tr></table></figure>
<p>All regular expressions in Prometheus use <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a>.</p>
<h4 id="Range-Vector-Selectors"><a href="#Range-Vector-Selectors" class="headerlink" title="Range Vector Selectors"></a>Range Vector Selectors</h4><p>Range vector literals work like instant vector literals, except that they select a range of samples back from the current instant. Syntactically, a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/basics/#time-durations">time duration</a> is appended in square brackets () at the end of a vector selector to specify how far back in time values should be fetched for each resulting range vector element.<code>[]</code></p>
<p>In this example, we select all the values we have recorded within the last 5 minutes for all time series that have the metric name and a label set to :<code>http_requests_total``job``prometheus</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;job=&quot;prometheus&quot;&#125;[5m]</span><br></pre></td></tr></table></figure>
<h4 id="Time-Durations"><a href="#Time-Durations" class="headerlink" title="Time Durations"></a>Time Durations</h4><p>Time durations are specified as a number, followed immediately by one of the following units:</p>
<ul>
<li><code>ms</code> - milliseconds</li>
<li><code>s</code> - seconds</li>
<li><code>m</code> - minutes</li>
<li><code>h</code> - hours</li>
<li><code>d</code> - days - assuming a day has always 24h</li>
<li><code>w</code> - weeks - assuming a week has always 7d</li>
<li><code>y</code> - years - assuming a year has always 365d</li>
</ul>
<p>Time durations can be combined, by concatenation. Units must be ordered from the longest to the shortest. A given unit must only appear once in a time duration.</p>
<p>Here are some examples of valid time durations:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5h</span><br><span class="line">1h30m</span><br><span class="line">5m</span><br><span class="line">10s</span><br></pre></td></tr></table></figure>
<h4 id="Offset-modifier"><a href="#Offset-modifier" class="headerlink" title="Offset modifier"></a>Offset modifier</h4><p>The modifier allows changing the time offset for individual instant and range vectors in a query.<code>offset</code></p>
<p>For example, the following expression returns the value of 5 minutes in the past relative to the current query evaluation time:<code>http_requests_total</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total offset 5m</span><br></pre></td></tr></table></figure>
<p>Note that the modifier always needs to follow the selector immediately, i.e. the following would be correct:<code>offset</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(http_requests_total&#123;method=&quot;GET&quot;&#125; offset 5m) // GOOD.</span><br></pre></td></tr></table></figure>
<p>While the following would be <em>incorrect</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(http_requests_total&#123;method=&quot;GET&quot;&#125;) offset 5m // INVALID.</span><br></pre></td></tr></table></figure>
<p>The same works for range vectors. This returns the 5-minute rate that had a week ago:<code>http_requests_total</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(http_requests_total[5m] offset 1w)</span><br></pre></td></tr></table></figure>
<p>For comparisons with temporal shifts forward in time, a negative offset can be specified:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(http_requests_total[5m] offset -1w)</span><br></pre></td></tr></table></figure>
<p>Note that this allows a query to look ahead of its evaluation time.</p>
<h4 id="modifier"><a href="#modifier" class="headerlink" title="@ modifier"></a>@ modifier</h4><p>The modifier allows changing the evaluation time for individual instant and range vectors in a query. The time supplied to the modifier is a unix timestamp and described with a float literal. <code>@``@</code></p>
<p>For example, the following expression returns the value of at :<code>http_requests_total``2021-01-04T07:40:00+00:00</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total @ 1609746000</span><br></pre></td></tr></table></figure>
<p>Note that the modifier always needs to follow the selector immediately, i.e. the following would be correct:<code>@</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(http_requests_total&#123;method=&quot;GET&quot;&#125; @ 1609746000) // GOOD.</span><br></pre></td></tr></table></figure>
<p>While the following would be <em>incorrect</em>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(http_requests_total&#123;method=&quot;GET&quot;&#125;) @ 1609746000 // INVALID.</span><br></pre></td></tr></table></figure>
<p>The same works for range vectors. This returns the 5-minute rate that had at :<code>http_requests_total``2021-01-04T07:40:00+00:00</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(http_requests_total[5m] @ 1609746000)</span><br></pre></td></tr></table></figure>
<p>The modifier supports all representation of float literals described above within the limits of . It can also be used along with the modifier where the offset is applied relative to the modifier time irrespective of which modifier is written first. These 2 queries will produce the same result.<code>@``int64``offset``@</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># offset after @</span><br><span class="line">http_requests_total @ 1609746000 offset 5m</span><br><span class="line"># offset before @</span><br><span class="line">http_requests_total offset 5m @ 1609746000</span><br></pre></td></tr></table></figure>
<p>Additionally, and can also be used as values for the modifier as special values.<code>start()``end()``@</code></p>
<p>For a range query, they resolve to the start and end of the range query respectively and remain the same for all steps.</p>
<p>For an instant query, and both resolve to the evaluation time.<code>start()``end()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total @ start()</span><br><span class="line">rate(http_requests_total[5m] @ end())</span><br></pre></td></tr></table></figure>
<p>Note that the modifier allows a query to look ahead of its evaluation time.<code>@</code></p>
<h3 id="Subquery"><a href="#Subquery" class="headerlink" title="Subquery"></a>Subquery</h3><p>Subquery allows you to run an instant query for a given range and resolution. The result of a subquery is a range vector.</p>
<p>Syntax: <code>&lt;instant_query&gt; &#39;[&#39; &lt;range&gt; &#39;:&#39; [&lt;resolution&gt;] &#39;]&#39; [ @ &lt;float_literal&gt; ] [ offset &lt;duration&gt; ]</code></p>
<ul>
<li><code>&lt;resolution&gt;</code> is optional. Default is the global evaluation interval.</li>
</ul>
<h3 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h3><p>Prometheus supports many binary and aggregation operators. These are described in detail in the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/">expression language operators</a> page.</p>
<h3 id="Functions"><a href="#Functions" class="headerlink" title="Functions"></a>Functions</h3><p>Prometheus supports several functions to operate on data. These are described in detail in the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/functions/">expression language functions</a> page.</p>
<h3 id="Comments"><a href="#Comments" class="headerlink" title="Comments"></a>Comments</h3><p>PromQL supports line comments that start with . Example:<code>#</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># This is a comment</span><br></pre></td></tr></table></figure>
<h3 id="Gotchas"><a href="#Gotchas" class="headerlink" title="Gotchas"></a>Gotchas</h3><h4 id="Staleness"><a href="#Staleness" class="headerlink" title="Staleness"></a>Staleness</h4><p>When queries are run, timestamps at which to sample data are selected independently of the actual present time series data. This is mainly to support cases like aggregation (, , and so on), where multiple aggregated time series do not exactly align in time. Because of their independence, Prometheus needs to assign a value at those timestamps for each relevant time series. It does so by simply taking the newest sample before this timestamp.<code>sum``avg</code></p>
<p>If a target scrape or rule evaluation no longer returns a sample for a time series that was previously present, that time series will be marked as stale. If a target is removed, its previously returned time series will be marked as stale soon afterwards.</p>
<p>If a query is evaluated at a sampling timestamp after a time series is marked stale, then no value is returned for that time series. If new samples are subsequently ingested for that time series, they will be returned as normal.</p>
<p>If no sample is found (by default) 5 minutes before a sampling timestamp, no value is returned for that time series at this point in time. This effectively means that time series “disappear” from graphs at times where their latest collected sample is older than 5 minutes or after they are marked stale.</p>
<p>Staleness will not be marked for time series that have timestamps included in their scrapes. Only the 5 minute threshold will be applied in that case.</p>
<h4 id="Avoiding-slow-queries-and-overloads"><a href="#Avoiding-slow-queries-and-overloads" class="headerlink" title="Avoiding slow queries and overloads"></a>Avoiding slow queries and overloads</h4><p>If a query needs to operate on a very large amount of data, graphing it might time out or overload the server or browser. Thus, when constructing queries over unknown data, always start building the query in the tabular view of Prometheus’s expression browser until the result set seems reasonable (hundreds, not thousands, of time series at most). Only when you have filtered or aggregated your data sufficiently, switch to graph mode. If the expression still takes too long to graph ad-hoc, pre-record it via a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/#recording-rules">recording rule</a>.</p>
<p>This is especially relevant for Prometheus’s query language, where a bare metric name selector like could expand to thousands of time series with different labels. Also keep in mind that expressions which aggregate over many time series will generate load on the server even if the output is only a small number of time series. This is similar to how it would be slow to sum all values of a column in a relational database, even if the output value is only a single number.<code>api_http_requests_total</code></p>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><h3 id="Binary-operators"><a href="#Binary-operators" class="headerlink" title="Binary operators"></a>Binary operators</h3><p>Prometheus’s query language supports basic logical and arithmetic operators. For operations between two instant vectors, the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching">matching behavior</a> can be modified.</p>
<h4 id="Arithmetic-binary-operators"><a href="#Arithmetic-binary-operators" class="headerlink" title="Arithmetic binary operators"></a>Arithmetic binary operators</h4><p>The following binary arithmetic operators exist in Prometheus:</p>
<ul>
<li><code>+</code> (addition)</li>
<li><code>-</code> (subtraction)</li>
<li><code>*</code> (multiplication)</li>
<li><code>/</code> (division)</li>
<li><code>%</code> (modulo)</li>
<li><code>^</code> (power/exponentiation)</li>
</ul>
<p>Binary arithmetic operators are defined between scalar/scalar, vector/scalar, and vector/vector value pairs.</p>
<p><strong>Between two scalars</strong>, the behavior is obvious: they evaluate to another scalar that is the result of the operator applied to both scalar operands.</p>
<p><strong>Between an instant vector and a scalar</strong>, the operator is applied to the value of every data sample in the vector. E.g. if a time series instant vector is multiplied by 2, the result is another vector in which every sample value of the original vector is multiplied by 2. The metric name is dropped.</p>
<p><strong>Between two instant vectors</strong>, a binary arithmetic operator is applied to each entry in the left-hand side vector and its <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/#vector-matching">matching element</a> in the right-hand vector. The result is propagated into the result vector with the grouping labels becoming the output label set. The metric name is dropped. Entries for which no matching entry in the right-hand vector can be found are not part of the result.</p>
<h4 id="Trigonometric-binary-operators"><a href="#Trigonometric-binary-operators" class="headerlink" title="Trigonometric binary operators"></a>Trigonometric binary operators</h4><p>The following trigonometric binary operators, which work in radians, exist in Prometheus:</p>
<ul>
<li><code>atan2</code> (based on <a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Atan2">https://pkg.go.dev/math#Atan2</a>)</li>
</ul>
<p>Trigonometric operators allow trigonometric functions to be executed on two vectors using vector matching, which isn’t available with normal functions. They act in the same manner as arithmetic operators.</p>
<h4 id="Comparison-binary-operators"><a href="#Comparison-binary-operators" class="headerlink" title="Comparison binary operators"></a>Comparison binary operators</h4><p>The following binary comparison operators exist in Prometheus:</p>
<ul>
<li><code>==</code> (equal)</li>
<li><code>!=</code> (not-equal)</li>
<li><code>&gt;</code> (greater-than)</li>
<li><code>&lt;</code> (less-than)</li>
<li><code>&gt;=</code> (greater-or-equal)</li>
<li><code>&lt;=</code> (less-or-equal)</li>
</ul>
<p>Comparison operators are defined between scalar/scalar, vector/scalar, and vector/vector value pairs. By default they filter. Their behavior can be modified by providing <code>bool</code> after the operator, which will return <code>0</code> or <code>1</code> for the value rather than filtering.</p>
<p><strong>Between two scalars</strong>, the <code>bool</code> modifier must be provided and these operators result in another scalar that is either <code>0</code> (<code>false</code>) or <code>1</code> (<code>true</code>), depending on the comparison result.</p>
<p><strong>Between an instant vector and a scalar</strong>, these operators are applied to the value of every data sample in the vector, and vector elements between which the comparison result is <code>false</code> get dropped from the result vector. If the <code>bool</code> modifier is provided, vector elements that would be dropped instead have the value <code>0</code> and vector elements that would be kept have the value <code>1</code>. The metric name is dropped if the <code>bool</code> modifier is provided.</p>
<p><strong>Between two instant vectors</strong>, these operators behave as a filter by default, applied to matching entries. Vector elements for which the expression is not true or which do not find a match on the other side of the expression get dropped from the result, while the others are propagated into a result vector with the grouping labels becoming the output label set. If the <code>bool</code> modifier is provided, vector elements that would have been dropped instead have the value <code>0</code> and vector elements that would be kept have the value <code>1</code>, with the grouping labels again becoming the output label set. The metric name is dropped if the <code>bool</code> modifier is provided.</p>
<h4 id="Logical-set-binary-operators"><a href="#Logical-set-binary-operators" class="headerlink" title="Logical/set binary operators"></a>Logical/set binary operators</h4><p>These logical/set binary operators are only defined between instant vectors:</p>
<ul>
<li><code>and</code> (intersection)</li>
<li><code>or</code> (union)</li>
<li><code>unless</code> (complement)</li>
</ul>
<p><code>vector1 and vector2</code> results in a vector consisting of the elements of <code>vector1</code> for which there are elements in <code>vector2</code> with exactly matching label sets. Other elements are dropped. The metric name and values are carried over from the left-hand side vector.</p>
<p><code>vector1 or vector2</code> results in a vector that contains all original elements (label sets + values) of <code>vector1</code> and additionally all elements of <code>vector2</code> which do not have matching label sets in <code>vector1</code>.</p>
<p><code>vector1 unless vector2</code> results in a vector consisting of the elements of <code>vector1</code> for which there are no elements in <code>vector2</code> with exactly matching label sets. All matching elements in both vectors are dropped.</p>
<h3 id="Vector-matching"><a href="#Vector-matching" class="headerlink" title="Vector matching"></a>Vector matching</h3><p>Operations between vectors attempt to find a matching element in the right-hand side vector for each entry in the left-hand side. There are two basic types of matching behavior: One-to-one and many-to-one/one-to-many.</p>
<h4 id="Vector-matching-keywords"><a href="#Vector-matching-keywords" class="headerlink" title="Vector matching keywords"></a>Vector matching keywords</h4><p>These vector matching keywords allow for matching between series with different label sets providing:</p>
<ul>
<li><code>on</code></li>
<li><code>ignoring</code></li>
</ul>
<p>Label lists provided to matching keywords will determine how vectors are combined. Examples can be found in <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/#one-to-one-vector-matches">One-to-one vector matches</a> and in <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/#many-to-one-and-one-to-many-vector-matches">Many-to-one and one-to-many vector matches</a></p>
<h4 id="Group-modifiers"><a href="#Group-modifiers" class="headerlink" title="Group modifiers"></a>Group modifiers</h4><p>These group modifiers enable many-to-one/one-to-many vector matching:</p>
<ul>
<li><code>group_left</code></li>
<li><code>group_right</code></li>
</ul>
<p>Label lists can be provided to the group modifier which contain labels from the “one”-side to be included in the result metrics.</p>
<p><em>Many-to-one and one-to-many matching are advanced use cases that should be carefully considered. Often a proper use of <code>ignoring(&lt;labels&gt;)</code> provides the desired outcome.</em></p>
<p><em>Grouping modifiers can only be used for <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/#comparison-binary-operators">comparison</a> and <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/#arithmetic-binary-operators">arithmetic</a>. Operations as <code>and</code>, <code>unless</code> and <code>or</code> operations match with all possible entries in the right vector by default.</em></p>
<h4 id="One-to-one-vector-matches"><a href="#One-to-one-vector-matches" class="headerlink" title="One-to-one vector matches"></a>One-to-one vector matches</h4><p><strong>One-to-one</strong> finds a unique pair of entries from each side of the operation. In the default case, that is an operation following the format <code>vector1 &lt;operator&gt; vector2</code>. Two entries match if they have the exact same set of labels and corresponding values. The <code>ignoring</code> keyword allows ignoring certain labels when matching, while the <code>on</code> keyword allows reducing the set of considered labels to a provided list:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) &lt;vector expr&gt;</span><br><span class="line">&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) &lt;vector expr&gt;</span><br></pre></td></tr></table></figure>
<p>Example input:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">method_code:http_errors:rate5m&#123;method=&quot;get&quot;, code=&quot;500&quot;&#125;  24</span><br><span class="line">method_code:http_errors:rate5m&#123;method=&quot;get&quot;, code=&quot;404&quot;&#125;  30</span><br><span class="line">method_code:http_errors:rate5m&#123;method=&quot;put&quot;, code=&quot;501&quot;&#125;  3</span><br><span class="line">method_code:http_errors:rate5m&#123;method=&quot;post&quot;, code=&quot;500&quot;&#125; 6</span><br><span class="line">method_code:http_errors:rate5m&#123;method=&quot;post&quot;, code=&quot;404&quot;&#125; 21</span><br><span class="line"></span><br><span class="line">method:http_requests:rate5m&#123;method=&quot;get&quot;&#125;  600</span><br><span class="line">method:http_requests:rate5m&#123;method=&quot;del&quot;&#125;  34</span><br><span class="line">method:http_requests:rate5m&#123;method=&quot;post&quot;&#125; 120</span><br></pre></td></tr></table></figure>
<p>Example query:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">method_code:http_errors:rate5m&#123;code=&quot;500&quot;&#125; / ignoring(code) method:http_requests:rate5m</span><br></pre></td></tr></table></figure>
<p>This returns a result vector containing the fraction of HTTP requests with status code of 500 for each method, as measured over the last 5 minutes. Without <code>ignoring(code)</code> there would have been no match as the metrics do not share the same set of labels. The entries with methods <code>put</code> and <code>del</code> have no match and will not show up in the result:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;method=&quot;get&quot;&#125;  0.04            //  24 / 600</span><br><span class="line">&#123;method=&quot;post&quot;&#125; 0.05            //   6 / 120</span><br></pre></td></tr></table></figure>
<h4 id="Many-to-one-and-one-to-many-vector-matches"><a href="#Many-to-one-and-one-to-many-vector-matches" class="headerlink" title="Many-to-one and one-to-many vector matches"></a>Many-to-one and one-to-many vector matches</h4><p><strong>Many-to-one</strong> and <strong>one-to-many</strong> matchings refer to the case where each vector element on the “one”-side can match with multiple elements on the “many”-side. This has to be explicitly requested using the <code>group_left</code> or <code>group_right</code> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/#group-modifiers">modifiers</a>, where left/right determines which vector has the higher cardinality.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;</span><br><span class="line">&lt;vector expr&gt; &lt;bin-op&gt; ignoring(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;</span><br><span class="line">&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_left(&lt;label list&gt;) &lt;vector expr&gt;</span><br><span class="line">&lt;vector expr&gt; &lt;bin-op&gt; on(&lt;label list&gt;) group_right(&lt;label list&gt;) &lt;vector expr&gt;</span><br></pre></td></tr></table></figure>
<p>The label list provided with the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/#group-modifiers">group modifier</a> contains additional labels from the “one”-side to be included in the result metrics. For <code>on</code> a label can only appear in one of the lists. Every time series of the result vector must be uniquely identifiable.</p>
<p>Example query:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">method_code:http_errors:rate5m / ignoring(code) group_left method:http_requests:rate5m</span><br></pre></td></tr></table></figure>
<p>In this case the left vector contains more than one entry per <code>method</code> label value. Thus, we indicate this using <code>group_left</code>. The elements from the right side are now matched with multiple elements with the same <code>method</code> label on the left:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;method=&quot;get&quot;, code=&quot;500&quot;&#125;  0.04            //  24 / 600</span><br><span class="line">&#123;method=&quot;get&quot;, code=&quot;404&quot;&#125;  0.05            //  30 / 600</span><br><span class="line">&#123;method=&quot;post&quot;, code=&quot;500&quot;&#125; 0.05            //   6 / 120</span><br><span class="line">&#123;method=&quot;post&quot;, code=&quot;404&quot;&#125; 0.175           //  21 / 120</span><br></pre></td></tr></table></figure>
<h4 id="Aggregation-operators"><a href="#Aggregation-operators" class="headerlink" title="Aggregation operators"></a>Aggregation operators</h4><p>Prometheus supports the following built-in aggregation operators that can be used to aggregate the elements of a single instant vector, resulting in a new vector of fewer elements with aggregated values:</p>
<ul>
<li><code>sum</code> (calculate sum over dimensions)</li>
<li><code>min</code> (select minimum over dimensions)</li>
<li><code>max</code> (select maximum over dimensions)</li>
<li><code>avg</code> (calculate the average over dimensions)</li>
<li><code>group</code> (all values in the resulting vector are 1)</li>
<li><code>stddev</code> (calculate population standard deviation over dimensions)</li>
<li><code>stdvar</code> (calculate population standard variance over dimensions)</li>
<li><code>count</code> (count number of elements in the vector)</li>
<li><code>count_values</code> (count number of elements with the same value)</li>
<li><code>bottomk</code> (smallest k elements by sample value)</li>
<li><code>topk</code> (largest k elements by sample value)</li>
<li><code>quantile</code> (calculate φ-quantile (0 ≤ φ ≤ 1) over dimensions)</li>
</ul>
<p>These operators can either be used to aggregate over <strong>all</strong> label dimensions or preserve distinct dimensions by including a <code>without</code> or <code>by</code> clause. These clauses may be used before or after the expression.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;aggr-op&gt; [without|by (&lt;label list&gt;)] ([parameter,] &lt;vector expression&gt;)</span><br></pre></td></tr></table></figure>
<p>or</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;aggr-op&gt;([parameter,] &lt;vector expression&gt;) [without|by (&lt;label list&gt;)]</span><br></pre></td></tr></table></figure>
<p><code>label list</code> is a list of unquoted labels that may include a trailing comma, i.e. both <code>(label1, label2)</code> and <code>(label1, label2,)</code> are valid syntax.</p>
<p><code>without</code> removes the listed labels from the result vector, while all other labels are preserved in the output. <code>by</code> does the opposite and drops labels that are not listed in the <code>by</code> clause, even if their label values are identical between all elements of the vector.</p>
<p><code>parameter</code> is only required for <code>count_values</code>, <code>quantile</code>, <code>topk</code> and <code>bottomk</code>.</p>
<p><code>count_values</code> outputs one time series per unique sample value. Each series has an additional label. The name of that label is given by the aggregation parameter, and the label value is the unique sample value. The value of each time series is the number of times that sample value was present.</p>
<p><code>topk</code> and <code>bottomk</code> are different from other aggregators in that a subset of the input samples, including the original labels, are returned in the result vector. <code>by</code> and <code>without</code> are only used to bucket the input vector.</p>
<p><code>quantile</code> calculates the φ-quantile, the value that ranks at number φ*N among the N metric values of the dimensions aggregated over. φ is provided as the aggregation parameter. For example, <code>quantile(0.5, ...)</code> calculates the median, <code>quantile(0.95, ...)</code> the 95th percentile. For φ = <code>NaN</code>, <code>NaN</code> is returned. For φ &lt; 0, <code>-Inf</code> is returned. For φ &gt; 1, <code>+Inf</code> is returned.</p>
<p>Example:</p>
<p>If the metric <code>http_requests_total</code> had time series that fan out by <code>application</code>, <code>instance</code>, and <code>group</code> labels, we could calculate the total number of seen HTTP requests per application and group over all instances via:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum without (instance) (http_requests_total)</span><br></pre></td></tr></table></figure>
<p>Which is equivalent to:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum by (application, group) (http_requests_total)</span><br></pre></td></tr></table></figure>
<p>If we are just interested in the total of HTTP requests we have seen in <strong>all</strong> applications, we could simply write:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum(http_requests_total)</span><br></pre></td></tr></table></figure>
<p>To count the number of binaries running each build version we could write:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count_values(&quot;version&quot;, build_version)</span><br></pre></td></tr></table></figure>
<p>To get the 5 largest HTTP requests counts across all instances we could write:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">topk(5, http_requests_total)</span><br></pre></td></tr></table></figure>
<h3 id="Binary-operator-precedence"><a href="#Binary-operator-precedence" class="headerlink" title="Binary operator precedence"></a>Binary operator precedence</h3><p>The following list shows the precedence of binary operators in Prometheus, from highest to lowest.</p>
<ol>
<li><code>^</code></li>
<li><code>*</code>, <code>/</code>, <code>%</code>, <code>atan2</code></li>
<li><code>+</code>, <code>-</code></li>
<li><code>==</code>, <code>!=</code>, <code>&lt;=</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&gt;</code></li>
<li><code>and</code>, <code>unless</code></li>
<li><code>or</code></li>
</ol>
<p>Operators on the same precedence level are left-associative. For example, <code>2 * 3 % 2</code> is equivalent to <code>(2 * 3) % 2</code>. However <code>^</code> is right associative, so <code>2 ^ 3 ^ 2</code> is equivalent to <code>2 ^ (3 ^ 2)</code>.</p>
<h3 id="Operators-for-native-histograms"><a href="#Operators-for-native-histograms" class="headerlink" title="Operators for native histograms"></a>Operators for native histograms</h3><p>Native histograms are an experimental feature. Ingesting native histograms has to be enabled via a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/feature_flags/#native-histograms">feature flag</a>. Once native histograms have been ingested, they can be queried (even after the feature flag has been disabled again). However, the operator support for native histograms is still very limited.</p>
<p>Logical/set binary operators work as expected even if histogram samples are involved. They only check for the existence of a vector element and don’t change their behavior depending on the sample type of an element (float or histogram).</p>
<p>The binary <code>+</code> operator between two native histograms and the <code>sum</code> aggregation operator to aggregate native histograms are fully supported. Even if the histograms involved have different bucket layouts, the buckets are automatically converted appropriately so that the operation can be performed. (With the currently supported bucket schemas, that’s always possible.) If either operator has to sum up a mix of histogram samples and float samples, the corresponding vector element is removed from the output vector entirely.</p>
<p>All other operators do not behave in a meaningful way. They either treat the histogram sample as if it were a float sample of value 0, or (in case of arithmetic operations between a scalar and a vector) they leave the histogram sample unchanged. This behavior will change to a meaningful one before native histograms are a stable feature.</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>Some functions have default arguments, e.g. <code>year(v=vector(time()) instant-vector)</code>. This means that there is one argument <code>v</code> which is an instant vector, which if not provided it will default to the value of the expression <code>vector(time())</code>.</p>
<p><em>Notes about the experimental native histograms:</em></p>
<ul>
<li>Ingesting native histograms has to be enabled via a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/feature_flags/#native-histograms">feature flag</a>. As long as no native histograms have been ingested into the TSDB, all functions will behave as usual.</li>
<li>Functions that do not explicitly mention native histograms in their documentation (see below) effectively treat a native histogram as a float sample of value 0. (This is confusing and will change before native histograms become a stable feature.)</li>
<li>Functions that do already act on native histograms might still change their behavior in the future.</li>
<li>If a function requires the same bucket layout between multiple native histograms it acts on, it will automatically convert them appropriately. (With the currently supported bucket schemas, that’s always possible.)</li>
</ul>
<h3 id="abs"><a href="#abs" class="headerlink" title="abs()"></a><code>abs()</code></h3><p><code>abs(v instant-vector)</code> returns the input vector with all sample values converted to their absolute value.</p>
<h3 id="absent"><a href="#absent" class="headerlink" title="absent()"></a><code>absent()</code></h3><p><code>absent(v instant-vector)</code> returns an empty vector if the vector passed to it has any elements (floats or native histograms) and a 1-element vector with the value 1 if the vector passed to it has no elements.</p>
<p>This is useful for alerting on when no time series exist for a given metric name and label combination.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">absent(nonexistent&#123;job=&quot;myjob&quot;&#125;)</span><br><span class="line"># =&gt; &#123;job=&quot;myjob&quot;&#125;</span><br><span class="line"></span><br><span class="line">absent(nonexistent&#123;job=&quot;myjob&quot;,instance=~&quot;.*&quot;&#125;)</span><br><span class="line"># =&gt; &#123;job=&quot;myjob&quot;&#125;</span><br><span class="line"></span><br><span class="line">absent(sum(nonexistent&#123;job=&quot;myjob&quot;&#125;))</span><br><span class="line"># =&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>In the first two examples, <code>absent()</code> tries to be smart about deriving labels of the 1-element output vector from the input vector.</p>
<h3 id="absent-over-time"><a href="#absent-over-time" class="headerlink" title="absent_over_time()"></a><code>absent_over_time()</code></h3><p><code>absent_over_time(v range-vector)</code> returns an empty vector if the range vector passed to it has any elements (floats or native histograms) and a 1-element vector with the value 1 if the range vector passed to it has no elements.</p>
<p>This is useful for alerting on when no time series exist for a given metric name and label combination for a certain amount of time.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">absent_over_time(nonexistent&#123;job=&quot;myjob&quot;&#125;[1h])</span><br><span class="line"># =&gt; &#123;job=&quot;myjob&quot;&#125;</span><br><span class="line"></span><br><span class="line">absent_over_time(nonexistent&#123;job=&quot;myjob&quot;,instance=~&quot;.*&quot;&#125;[1h])</span><br><span class="line"># =&gt; &#123;job=&quot;myjob&quot;&#125;</span><br><span class="line"></span><br><span class="line">absent_over_time(sum(nonexistent&#123;job=&quot;myjob&quot;&#125;)[1h:])</span><br><span class="line"># =&gt; &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>In the first two examples, <code>absent_over_time()</code> tries to be smart about deriving labels of the 1-element output vector from the input vector.</p>
<h3 id="ceil"><a href="#ceil" class="headerlink" title="ceil()"></a><code>ceil()</code></h3><p><code>ceil(v instant-vector)</code> rounds the sample values of all elements in <code>v</code> up to the nearest integer.</p>
<h3 id="changes"><a href="#changes" class="headerlink" title="changes()"></a><code>changes()</code></h3><p>For each input time series, <code>changes(v range-vector)</code> returns the number of times its value has changed within the provided time range as an instant vector.</p>
<h3 id="clamp"><a href="#clamp" class="headerlink" title="clamp()"></a><code>clamp()</code></h3><p><code>clamp(v instant-vector, min scalar, max scalar)</code> clamps the sample values of all elements in <code>v</code> to have a lower limit of <code>min</code> and an upper limit of <code>max</code>.</p>
<p>Special cases: - Return an empty vector if <code>min &gt; max</code> - Return <code>NaN</code> if <code>min</code> or <code>max</code> is <code>NaN</code></p>
<h3 id="clamp-max"><a href="#clamp-max" class="headerlink" title="clamp_max()"></a><code>clamp_max()</code></h3><p><code>clamp_max(v instant-vector, max scalar)</code> clamps the sample values of all elements in <code>v</code> to have an upper limit of <code>max</code>.</p>
<h3 id="clamp-min"><a href="#clamp-min" class="headerlink" title="clamp_min()"></a><code>clamp_min()</code></h3><p><code>clamp_min(v instant-vector, min scalar)</code> clamps the sample values of all elements in <code>v</code> to have a lower limit of <code>min</code>.</p>
<h3 id="day-of-month"><a href="#day-of-month" class="headerlink" title="day_of_month()"></a><code>day_of_month()</code></h3><p><code>day_of_month(v=vector(time()) instant-vector)</code> returns the day of the month for each of the given times in UTC. Returned values are from 1 to 31.</p>
<h3 id="day-of-week"><a href="#day-of-week" class="headerlink" title="day_of_week()"></a><code>day_of_week()</code></h3><p><code>day_of_week(v=vector(time()) instant-vector)</code> returns the day of the week for each of the given times in UTC. Returned values are from 0 to 6, where 0 means Sunday etc.</p>
<h3 id="day-of-year"><a href="#day-of-year" class="headerlink" title="day_of_year()"></a><code>day_of_year()</code></h3><p><code>day_of_year(v=vector(time()) instant-vector)</code> returns the day of the year for each of the given times in UTC. Returned values are from 1 to 365 for non-leap years, and 1 to 366 in leap years.</p>
<h3 id="days-in-month"><a href="#days-in-month" class="headerlink" title="days_in_month()"></a><code>days_in_month()</code></h3><p><code>days_in_month(v=vector(time()) instant-vector)</code> returns number of days in the month for each of the given times in UTC. Returned values are from 28 to 31.</p>
<h3 id="delta"><a href="#delta" class="headerlink" title="delta()"></a><code>delta()</code></h3><p><code>delta(v range-vector)</code> calculates the difference between the first and last value of each time series element in a range vector <code>v</code>, returning an instant vector with the given deltas and equivalent labels. The delta is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if the sample values are all integers.</p>
<p>The following example expression returns the difference in CPU temperature between now and 2 hours ago:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delta(cpu_temp_celsius&#123;host=&quot;zeus&quot;&#125;[2h])</span><br></pre></td></tr></table></figure>
<p><code>delta</code> acts on native histograms by calculating a new histogram where each compononent (sum and count of observations, buckets) is the difference between the respective component in the first and last native histogram in <code>v</code>. However, each element in <code>v</code> that contains a mix of float and native histogram samples within the range, will be missing from the result vector.</p>
<p><code>delta</code> should only be used with gauges and native histograms where the components behave like gauges (so-called gauge histograms).</p>
<h3 id="deriv"><a href="#deriv" class="headerlink" title="deriv()"></a><code>deriv()</code></h3><p><code>deriv(v range-vector)</code> calculates the per-second derivative of the time series in a range vector <code>v</code>, using <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Simple_linear_regression">simple linear regression</a>. The range vector must have at least two samples in order to perform the calculation. When <code>+Inf</code> or <code>-Inf</code> are found in the range vector, the slope and offset value calculated will be <code>NaN</code>.</p>
<p><code>deriv</code> should only be used with gauges.</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp()"></a><code>exp()</code></h3><p><code>exp(v instant-vector)</code> calculates the exponential function for all elements in <code>v</code>. Special cases are:</p>
<ul>
<li><code>Exp(+Inf) = +Inf</code></li>
<li><code>Exp(NaN) = NaN</code></li>
</ul>
<h3 id="floor"><a href="#floor" class="headerlink" title="floor()"></a><code>floor()</code></h3><p><code>floor(v instant-vector)</code> rounds the sample values of all elements in <code>v</code> down to the nearest integer.</p>
<h3 id="histogram-count-and-histogram-sum"><a href="#histogram-count-and-histogram-sum" class="headerlink" title="histogram_count() and histogram_sum()"></a><code>histogram_count()</code> and <code>histogram_sum()</code></h3><p><em>Both functions only act on native histograms, which are an experimental feature. The behavior of these functions may change in future versions of Prometheus, including their removal from PromQL.</em></p>
<p><code>histogram_count(v instant-vector)</code> returns the count of observations stored in a native histogram. Samples that are not native histograms are ignored and do not show up in the returned vector.</p>
<p>Similarly, <code>histogram_sum(v instant-vector)</code> returns the sum of observations stored in a native histogram.</p>
<p>Use <code>histogram_count</code> in the following way to calculate a rate of observations (in this case corresponding to “requests per second”) from a native histogram:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram_count(rate(http_request_duration_seconds[10m]))</span><br></pre></td></tr></table></figure>
<p>The additional use of <code>histogram_sum</code> enables the calculation of the average of observed values (in this case corresponding to “average request duration”):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  histogram_sum(rate(http_request_duration_seconds[10m]))</span><br><span class="line">/</span><br><span class="line">  histogram_count(rate(http_request_duration_seconds[10m]))</span><br></pre></td></tr></table></figure>
<h3 id="histogram-fraction"><a href="#histogram-fraction" class="headerlink" title="histogram_fraction()"></a><code>histogram_fraction()</code></h3><p><em>This function only acts on native histograms, which are an experimental feature. The behavior of this function may change in future versions of Prometheus, including its removal from PromQL.</em></p>
<p>For a native histogram, <code>histogram_fraction(lower scalar, upper scalar, v instant-vector)</code> returns the estimated fraction of observations between the provided lower and upper values. Samples that are not native histograms are ignored and do not show up in the returned vector.</p>
<p>For example, the following expression calculates the fraction of HTTP requests over the last hour that took 200ms or less:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram_fraction(0, 0.2, rate(http_request_duration_seconds[1h]))</span><br></pre></td></tr></table></figure>
<p>The error of the estimation depends on the resolution of the underlying native histogram and how closely the provided boundaries are aligned with the bucket boundaries in the histogram.</p>
<p><code>+Inf</code> and <code>-Inf</code> are valid boundary values. For example, if the histogram in the expression above included negative observations (which shouldn’t be the case for request durations), the appropriate lower boundary to include all observations less than or equal 0.2 would be <code>-Inf</code> rather than <code>0</code>.</p>
<p>Whether the provided boundaries are inclusive or exclusive is only relevant if the provided boundaries are precisely aligned with bucket boundaries in the underlying native histogram. In this case, the behavior depends on the schema definition of the histogram. The currently supported schemas all feature inclusive upper boundaries and exclusive lower boundaries for positive values (and vice versa for negative values). Without a precise alignment of boundaries, the function uses linear interpolation to estimate the fraction. With the resulting uncertainty, it becomes irrelevant if the boundaries are inclusive or exclusive.</p>
<h3 id="histogram-quantile"><a href="#histogram-quantile" class="headerlink" title="histogram_quantile()"></a><code>histogram_quantile()</code></h3><p><code>histogram_quantile(φ scalar, b instant-vector)</code> calculates the φ-quantile (0 ≤ φ ≤ 1) from a <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/concepts/metric_types/#histogram">conventional histogram</a> or from a native histogram. (See <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/practices/histograms">histograms and summaries</a> for a detailed explanation of φ-quantiles and the usage of the (conventional) histogram metric type in general.)</p>
<p><em>Note that native histograms are an experimental feature. The behavior of this function when dealing with native histograms may change in future versions of Prometheus.</em></p>
<p>The conventional float samples in <code>b</code> are considered the counts of observations in each bucket of one or more conventional histograms. Each float sample must have a label <code>le</code> where the label value denotes the inclusive upper bound of the bucket. (Float samples without such a label are silently ignored.) The other labels and the metric name are used to identify the buckets belonging to each conventional histogram. The <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/concepts/metric_types/#histogram">histogram metric type</a> automatically provides time series with the <code>_bucket</code> suffix and the appropriate labels.</p>
<p>The native histogram samples in <code>b</code> are treated each individually as a separate histogram to calculate the quantile from.</p>
<p>As long as no naming collisions arise, <code>b</code> may contain a mix of conventional and native histograms.</p>
<p>Use the <code>rate()</code> function to specify the time window for the quantile calculation.</p>
<p>Example: A histogram metric is called <code>http_request_duration_seconds</code> (and therefore the metric name for the buckets of a conventional histogram is <code>http_request_duration_seconds_bucket</code>). To calculate the 90th percentile of request durations over the last 10m, use the following expression in case <code>http_request_duration_seconds</code> is a conventional histogram:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram_quantile(0.9, rate(http_request_duration_seconds_bucket[10m]))</span><br></pre></td></tr></table></figure>
<p>For a native histogram, use the following expression instead:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram_quantile(0.9, rate(http_request_duration_seconds[10m]))</span><br></pre></td></tr></table></figure>
<p>The quantile is calculated for each label combination in <code>http_request_duration_seconds</code>. To aggregate, use the <code>sum()</code> aggregator around the <code>rate()</code> function. Since the <code>le</code> label is required by <code>histogram_quantile()</code> to deal with conventional histograms, it has to be included in the <code>by</code> clause. The following expression aggregates the 90th percentile by <code>job</code> for conventional histograms:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram_quantile(0.9, sum by (job, le) (rate(http_request_duration_seconds_bucket[10m])))</span><br></pre></td></tr></table></figure>
<p>When aggregating native histograms, the expression simplifies to:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram_quantile(0.9, sum by (job) (rate(http_request_duration_seconds[10m])))</span><br></pre></td></tr></table></figure>
<p>To aggregate all conventional histograms, specify only the <code>le</code> label:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram_quantile(0.9, sum by (le) (rate(http_request_duration_seconds_bucket[10m])))</span><br></pre></td></tr></table></figure>
<p>With native histograms, aggregating everything works as usual without any <code>by</code> clause:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">histogram_quantile(0.9, sum(rate(http_request_duration_seconds[10m])))</span><br></pre></td></tr></table></figure>
<p>The <code>histogram_quantile()</code> function interpolates quantile values by assuming a linear distribution within a bucket.</p>
<p>If <code>b</code> has 0 observations, <code>NaN</code> is returned. For φ &lt; 0, <code>-Inf</code> is returned. For φ &gt; 1, <code>+Inf</code> is returned. For φ = <code>NaN</code>, <code>NaN</code> is returned.</p>
<p>The following is only relevant for conventional histograms: If <code>b</code> contains fewer than two buckets, <code>NaN</code> is returned. The highest bucket must have an upper bound of <code>+Inf</code>. (Otherwise, <code>NaN</code> is returned.) If a quantile is located in the highest bucket, the upper bound of the second highest bucket is returned. A lower limit of the lowest bucket is assumed to be 0 if the upper bound of that bucket is greater than 0. In that case, the usual linear interpolation is applied within that bucket. Otherwise, the upper bound of the lowest bucket is returned for quantiles located in the lowest bucket.</p>
<h3 id="holt-winters"><a href="#holt-winters" class="headerlink" title="holt_winters()"></a><code>holt_winters()</code></h3><p><code>holt_winters(v range-vector, sf scalar, tf scalar)</code> produces a smoothed value for time series based on the range in <code>v</code>. The lower the smoothing factor <code>sf</code>, the more importance is given to old data. The higher the trend factor <code>tf</code>, the more trends in the data is considered. Both <code>sf</code> and <code>tf</code> must be between 0 and 1.</p>
<p><code>holt_winters</code> should only be used with gauges.</p>
<h3 id="hour"><a href="#hour" class="headerlink" title="hour()"></a><code>hour()</code></h3><p><code>hour(v=vector(time()) instant-vector)</code> returns the hour of the day for each of the given times in UTC. Returned values are from 0 to 23.</p>
<h3 id="idelta"><a href="#idelta" class="headerlink" title="idelta()"></a><code>idelta()</code></h3><p><code>idelta(v range-vector)</code> calculates the difference between the last two samples in the range vector <code>v</code>, returning an instant vector with the given deltas and equivalent labels.</p>
<p><code>idelta</code> should only be used with gauges.</p>
<h3 id="increase"><a href="#increase" class="headerlink" title="increase()"></a><code>increase()</code></h3><p><code>increase(v range-vector)</code> calculates the increase in the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. The increase is extrapolated to cover the full time range as specified in the range vector selector, so that it is possible to get a non-integer result even if a counter increases only by integer increments.</p>
<p>The following example expression returns the number of HTTP requests as measured over the last 5 minutes, per time series in the range vector:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">increase(http_requests_total&#123;job=&quot;api-server&quot;&#125;[5m])</span><br></pre></td></tr></table></figure>
<p><code>increase</code> acts on native histograms by calculating a new histogram where each compononent (sum and count of observations, buckets) is the increase between the respective component in the first and last native histogram in <code>v</code>. However, each element in <code>v</code> that contains a mix of float and native histogram samples within the range, will be missing from the result vector.</p>
<p><code>increase</code> should only be used with counters and native histograms where the components behave like counters. It is syntactic sugar for <code>rate(v)</code> multiplied by the number of seconds under the specified time range window, and should be used primarily for human readability. Use <code>rate</code> in recording rules so that increases are tracked consistently on a per-second basis.</p>
<h3 id="irate"><a href="#irate" class="headerlink" title="irate()"></a><code>irate()</code></h3><p><code>irate(v range-vector)</code> calculates the per-second instant rate of increase of the time series in the range vector. This is based on the last two data points. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for.</p>
<p>The following example expression returns the per-second rate of HTTP requests looking up to 5 minutes back for the two most recent data points, per time series in the range vector:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">irate(http_requests_total&#123;job=&quot;api-server&quot;&#125;[5m])</span><br></pre></td></tr></table></figure>
<p><code>irate</code> should only be used when graphing volatile, fast-moving counters. Use <code>rate</code> for alerts and slow-moving counters, as brief changes in the rate can reset the <code>FOR</code> clause and graphs consisting entirely of rare spikes are hard to read.</p>
<p>Note that when combining <code>irate()</code> with an <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/operators/#aggregation-operators">aggregation operator</a> (e.g. <code>sum()</code>) or a function aggregating over time (any function ending in <code>_over_time</code>), always take a <code>irate()</code> first, then aggregate. Otherwise <code>irate()</code> cannot detect counter resets when your target restarts.</p>
<h3 id="label-join"><a href="#label-join" class="headerlink" title="label_join()"></a><code>label_join()</code></h3><p>For each timeseries in <code>v</code>, <code>label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)</code> joins all the values of all the <code>src_labels</code> using <code>separator</code> and returns the timeseries with the label <code>dst_label</code> containing the joined value. There can be any number of <code>src_labels</code> in this function.</p>
<p>This example will return a vector with each time series having a <code>foo</code> label with the value <code>a,b,c</code> added to it:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">label_join(up&#123;job=&quot;api-server&quot;,src1=&quot;a&quot;,src2=&quot;b&quot;,src3=&quot;c&quot;&#125;, &quot;foo&quot;, &quot;,&quot;, &quot;src1&quot;, &quot;src2&quot;, &quot;src3&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="label-replace"><a href="#label-replace" class="headerlink" title="label_replace()"></a><code>label_replace()</code></h3><p>For each timeseries in <code>v</code>, <code>label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)</code> matches the regular expression <code>regex</code> against the value of the label <code>src_label</code>. If it matches, the value of the label <code>dst_label</code> in the returned timeseries will be the expansion of <code>replacement</code>, together with the original labels in the input. Capturing groups in the regular expression can be referenced with <code>$1</code>, <code>$2</code>, etc. If the regular expression doesn’t match then the timeseries is returned unchanged.</p>
<p>This example will return timeseries with the values <code>a:c</code> at label <code>service</code> and <code>a</code> at label <code>foo</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">label_replace(up&#123;job=&quot;api-server&quot;,service=&quot;a:c&quot;&#125;, &quot;foo&quot;, &quot;$1&quot;, &quot;service&quot;, &quot;(.*):.*&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="ln"><a href="#ln" class="headerlink" title="ln()"></a><code>ln()</code></h3><p><code>ln(v instant-vector)</code> calculates the natural logarithm for all elements in <code>v</code>. Special cases are:</p>
<ul>
<li><code>ln(+Inf) = +Inf</code></li>
<li><code>ln(0) = -Inf</code></li>
<li><code>ln(x &lt; 0) = NaN</code></li>
<li><code>ln(NaN) = NaN</code></li>
</ul>
<h3 id="log2"><a href="#log2" class="headerlink" title="log2()"></a><code>log2()</code></h3><p><code>log2(v instant-vector)</code> calculates the binary logarithm for all elements in <code>v</code>. The special cases are equivalent to those in <code>ln</code>.</p>
<h3 id="log10"><a href="#log10" class="headerlink" title="log10()"></a><code>log10()</code></h3><p><code>log10(v instant-vector)</code> calculates the decimal logarithm for all elements in <code>v</code>. The special cases are equivalent to those in <code>ln</code>.</p>
<h3 id="minute"><a href="#minute" class="headerlink" title="minute()"></a><code>minute()</code></h3><p><code>minute(v=vector(time()) instant-vector)</code> returns the minute of the hour for each of the given times in UTC. Returned values are from 0 to 59.</p>
<h3 id="month"><a href="#month" class="headerlink" title="month()"></a><code>month()</code></h3><p><code>month(v=vector(time()) instant-vector)</code> returns the month of the year for each of the given times in UTC. Returned values are from 1 to 12, where 1 means January etc.</p>
<h3 id="predict-linear"><a href="#predict-linear" class="headerlink" title="predict_linear()"></a><code>predict_linear()</code></h3><p><code>predict_linear(v range-vector, t scalar)</code> predicts the value of time series <code>t</code> seconds from now, based on the range vector <code>v</code>, using <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Simple_linear_regression">simple linear regression</a>. The range vector must have at least two samples in order to perform the calculation. When <code>+Inf</code> or <code>-Inf</code> are found in the range vector, the slope and offset value calculated will be <code>NaN</code>.</p>
<p><code>predict_linear</code> should only be used with gauges.</p>
<h3 id="rate"><a href="#rate" class="headerlink" title="rate()"></a><code>rate()</code></h3><p><code>rate(v range-vector)</code> calculates the per-second average rate of increase of the time series in the range vector. Breaks in monotonicity (such as counter resets due to target restarts) are automatically adjusted for. Also, the calculation extrapolates to the ends of the time range, allowing for missed scrapes or imperfect alignment of scrape cycles with the range’s time period.</p>
<p>The following example expression returns the per-second rate of HTTP requests as measured over the last 5 minutes, per time series in the range vector:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(http_requests_total&#123;job=&quot;api-server&quot;&#125;[5m])</span><br></pre></td></tr></table></figure>
<p><code>rate</code> acts on native histograms by calculating a new histogram where each compononent (sum and count of observations, buckets) is the rate of increase between the respective component in the first and last native histogram in <code>v</code>. However, each element in <code>v</code> that contains a mix of float and native histogram samples within the range, will be missing from the result vector.</p>
<p><code>rate</code> should only be used with counters and native histograms where the components behave like counters. It is best suited for alerting, and for graphing of slow-moving counters.</p>
<p>Note that when combining <code>rate()</code> with an aggregation operator (e.g. <code>sum()</code>) or a function aggregating over time (any function ending in <code>_over_time</code>), always take a <code>rate()</code> first, then aggregate. Otherwise <code>rate()</code> cannot detect counter resets when your target restarts.</p>
<h3 id="resets"><a href="#resets" class="headerlink" title="resets()"></a><code>resets()</code></h3><p>For each input time series, <code>resets(v range-vector)</code> returns the number of counter resets within the provided time range as an instant vector. Any decrease in the value between two consecutive samples is interpreted as a counter reset.</p>
<p><code>resets</code> should only be used with counters.</p>
<h3 id="round"><a href="#round" class="headerlink" title="round()"></a><code>round()</code></h3><p><code>round(v instant-vector, to_nearest=1 scalar)</code> rounds the sample values of all elements in <code>v</code> to the nearest integer. Ties are resolved by rounding up. The optional <code>to_nearest</code> argument allows specifying the nearest multiple to which the sample values should be rounded. This multiple may also be a fraction.</p>
<h3 id="scalar"><a href="#scalar" class="headerlink" title="scalar()"></a><code>scalar()</code></h3><p>Given a single-element input vector, <code>scalar(v instant-vector)</code> returns the sample value of that single element as a scalar. If the input vector does not have exactly one element, <code>scalar</code> will return <code>NaN</code>.</p>
<h3 id="sgn"><a href="#sgn" class="headerlink" title="sgn()"></a><code>sgn()</code></h3><p><code>sgn(v instant-vector)</code> returns a vector with all sample values converted to their sign, defined as this: 1 if v is positive, -1 if v is negative and 0 if v is equal to zero.</p>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort()"></a><code>sort()</code></h3><p><code>sort(v instant-vector)</code> returns vector elements sorted by their sample values, in ascending order.</p>
<h3 id="sort-desc"><a href="#sort-desc" class="headerlink" title="sort_desc()"></a><code>sort_desc()</code></h3><p>Same as <code>sort</code>, but sorts in descending order.</p>
<h3 id="sqrt"><a href="#sqrt" class="headerlink" title="sqrt()"></a><code>sqrt()</code></h3><p><code>sqrt(v instant-vector)</code> calculates the square root of all elements in <code>v</code>.</p>
<h3 id="time"><a href="#time" class="headerlink" title="time()"></a><code>time()</code></h3><p><code>time()</code> returns the number of seconds since January 1, 1970 UTC. Note that this does not actually return the current time, but the time at which the expression is to be evaluated.</p>
<h3 id="timestamp"><a href="#timestamp" class="headerlink" title="timestamp()"></a><code>timestamp()</code></h3><p><code>timestamp(v instant-vector)</code> returns the timestamp of each of the samples of the given vector as the number of seconds since January 1, 1970 UTC.</p>
<h3 id="vector"><a href="#vector" class="headerlink" title="vector()"></a><code>vector()</code></h3><p><code>vector(s scalar)</code> returns the scalar <code>s</code> as a vector with no labels.</p>
<h3 id="year"><a href="#year" class="headerlink" title="year()"></a><code>year()</code></h3><p><code>year(v=vector(time()) instant-vector)</code> returns the year for each of the given times in UTC.</p>
<h3 id="lt-aggregation-gt-over-time"><a href="#lt-aggregation-gt-over-time" class="headerlink" title="&lt;aggregation&gt;_over_time()"></a><code>&lt;aggregation&gt;_over_time()</code></h3><p>The following functions allow aggregating each series of a given range vector over time and return an instant vector with per-series aggregation results:</p>
<ul>
<li><code>avg_over_time(range-vector)</code>: the average value of all points in the specified interval.</li>
<li><code>min_over_time(range-vector)</code>: the minimum value of all points in the specified interval.</li>
<li><code>max_over_time(range-vector)</code>: the maximum value of all points in the specified interval.</li>
<li><code>sum_over_time(range-vector)</code>: the sum of all values in the specified interval.</li>
<li><code>count_over_time(range-vector)</code>: the count of all values in the specified interval.</li>
<li><code>quantile_over_time(scalar, range-vector)</code>: the φ-quantile (0 ≤ φ ≤ 1) of the values in the specified interval.</li>
<li><code>stddev_over_time(range-vector)</code>: the population standard deviation of the values in the specified interval.</li>
<li><code>stdvar_over_time(range-vector)</code>: the population standard variance of the values in the specified interval.</li>
<li><code>last_over_time(range-vector)</code>: the most recent point value in specified interval.</li>
<li><code>present_over_time(range-vector)</code>: the value 1 for any series in the specified interval.</li>
</ul>
<p>Note that all values in the specified interval have the same weight in the aggregation even if the values are not equally spaced throughout the interval.</p>
<h3 id="Trigonometric-Functions"><a href="#Trigonometric-Functions" class="headerlink" title="Trigonometric Functions"></a>Trigonometric Functions</h3><p>The trigonometric functions work in radians:</p>
<ul>
<li><code>acos(v instant-vector)</code>: calculates the arccosine of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Acos">special cases</a>).</li>
<li><code>acosh(v instant-vector)</code>: calculates the inverse hyperbolic cosine of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Acosh">special cases</a>).</li>
<li><code>asin(v instant-vector)</code>: calculates the arcsine of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Asin">special cases</a>).</li>
<li><code>asinh(v instant-vector)</code>: calculates the inverse hyperbolic sine of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Asinh">special cases</a>).</li>
<li><code>atan(v instant-vector)</code>: calculates the arctangent of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Atan">special cases</a>).</li>
<li><code>atanh(v instant-vector)</code>: calculates the inverse hyperbolic tangent of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Atanh">special cases</a>).</li>
<li><code>cos(v instant-vector)</code>: calculates the cosine of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Cos">special cases</a>).</li>
<li><code>cosh(v instant-vector)</code>: calculates the hyperbolic cosine of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Cosh">special cases</a>).</li>
<li><code>sin(v instant-vector)</code>: calculates the sine of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Sin">special cases</a>).</li>
<li><code>sinh(v instant-vector)</code>: calculates the hyperbolic sine of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Sinh">special cases</a>).</li>
<li><code>tan(v instant-vector)</code>: calculates the tangent of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Tan">special cases</a>).</li>
<li><code>tanh(v instant-vector)</code>: calculates the hyperbolic tangent of all elements in <code>v</code> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://pkg.go.dev/math#Tanh">special cases</a>).</li>
</ul>
<p>The following are useful for converting between degrees and radians:</p>
<ul>
<li><code>deg(v instant-vector)</code>: converts radians to degrees for all elements in <code>v</code>.</li>
<li><code>pi()</code>: returns pi.</li>
<li><code>rad(v instant-vector)</code>: converts degrees to radians for all elements in <code>v</code>.</li>
</ul>
<h2 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h2><h3 id="简单的时间序列选择"><a href="#简单的时间序列选择" class="headerlink" title="简单的时间序列选择"></a>简单的时间序列选择</h3><p>返回所有带有<code>http_requests_total</code>指标(metric)的时间序列:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total</span><br></pre></td></tr></table></figure>
<p>返回所有带有<code>http_requests_total</code>指标(metric)和带<code>job</code>和<code>handler</code>标签(label)的时间序列:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;job=&quot;apiserver&quot;, handler=&quot;/api/comments&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>返回相同的向量的一整个时间范围（在本示例中为查询时间前5分钟），让它变成一个<a href="#表达式语言数据类型">范围向量(range vector)</a>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;job=&quot;apiserver&quot;, handler=&quot;/api/comments&quot;&#125;[5m]</span><br></pre></td></tr></table></figure>
<p>请注意，一个返回<a href="#表达式语言数据类型">范围向量(range vector)</a>的表达式是不能直接绘制图表的，但是在表达式浏览器的表格视图（控制台）中查看。</p>
<p>使用正则表达式(regular expressions)，你可以选择时间序列那些匹配特定模式的<code>job</code>，在这个示例中，所有的<code>job</code>都是<code>server</code>结尾的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;job=~&quot;.*server&quot;&#125;</span><br></pre></td></tr></table></figure>
<p>Prometheus 使用的所有正则表达式遵循<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/google/re2/wiki/Syntax">RE2 syntax</a>。</p>
<p>为了查询除了4xx之外的HTTP状态码，你可以运行下面的语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;status!~&quot;4..&quot;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>返回30分钟内5分钟速率（5分钟为一个时间段求得的速率），分辨率(resolution)为1分钟（每一分钟一个数据点，也就是有三十个数据点）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(http_requests_total[5m])[30m:1m]</span><br></pre></td></tr></table></figure>
<p>这是个嵌套子查询的示例. 带 <code>deriv</code> 函数的子查询使用默认分辨率. 请注意，不是必要的情况下使用子查询是不明智的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max_over_time(deriv(rate(distance_covered_total[5s])[30s:5s])[10m:])</span><br></pre></td></tr></table></figure>
<h3 id="使用方法，运算符等"><a href="#使用方法，运算符等" class="headerlink" title="使用方法，运算符等"></a>使用方法，运算符等</h3><p>返回最近5分钟内测量的所有带有<code>http_requests_total</code> metric名称的时间序列每秒的速率</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(http_requests_total[5m])</span><br></pre></td></tr></table></figure>
<p>假设<code>http_requests_total</code>时间序列全部带有job标签（按照作业名展开）和 <code>instance</code>（按作业实例展开），我们可能希望去对所有实例的速率求和，以至于我们获取更少的时间序列输出，但是仍然保留<code>job</code>标签</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sum by (job) (rate(http_requests_total[5m]))</span><br></pre></td></tr></table></figure>
<p>如果我们有两个不同的metrics拥有相同维度的标签，我们可以对它们使用二进制运算符，两边都有相同标签集的元素会被匹配并传播到输出。例如，这个表达式返回每个实例未使用的单位为MiB的内存空间（在一个虚拟的集群调度中暴露了这些它运行的实例的metric）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(instance_memory_limit_bytes - instance_memory_usage_bytes) / 1024 / 1024</span><br></pre></td></tr></table></figure>
<p>相同的表达式，但是按照应用程序求和，可以像这样写：</p>
<p>The same expression, but summed by application, could be written like this:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sum by (app, proc) (</span><br><span class="line">  instance_memory_limit_bytes - instance_memory_usage_bytes</span><br><span class="line">) / 1024 / 1024</span><br></pre></td></tr></table></figure>
<p>如果相同的虚拟集群调度暴露了每一个实例的CPU的使用指标(metric)，像下面这样:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">instance_cpu_time_ns&#123;app=&quot;lion&quot;, proc=&quot;web&quot;, rev=&quot;34d0f99&quot;, env=&quot;prod&quot;, job=&quot;cluster-manager&quot;&#125;</span><br><span class="line">instance_cpu_time_ns&#123;app=&quot;elephant&quot;, proc=&quot;worker&quot;, rev=&quot;34d0f99&quot;, env=&quot;prod&quot;, job=&quot;cluster-manager&quot;&#125;</span><br><span class="line">instance_cpu_time_ns&#123;app=&quot;turtle&quot;, proc=&quot;api&quot;, rev=&quot;4d3a513&quot;, env=&quot;prod&quot;, job=&quot;cluster-manager&quot;&#125;</span><br><span class="line">instance_cpu_time_ns&#123;app=&quot;fox&quot;, proc=&quot;widget&quot;, rev=&quot;4d3a513&quot;, env=&quot;prod&quot;, job=&quot;cluster-manager&quot;&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>…我们可以获取根据应用程序(<code>app</code>)和进场类型(<code>proc</code>)分组的前三CPU使用者，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">topk(3, sum by (app, proc) (rate(instance_cpu_time_ns[5m])))</span><br></pre></td></tr></table></figure>
<p>假定这个metric每一个运行的实例拥有一个时间序列，你可以像这样计算每个应用程序运行实例数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count by (app) (instance_cpu_time_ns)</span><br></pre></td></tr></table></figure>
<h2 id="HTTP-API"><a href="#HTTP-API" class="headerlink" title="HTTP API"></a>HTTP API</h2><p>The current stable HTTP API is reachable under <code>/api/v1</code> on a Prometheus server. Any non-breaking additions will be added under that endpoint.</p>
<h3 id="Format-overview"><a href="#Format-overview" class="headerlink" title="Format overview"></a>Format overview</h3><p>The API response format is JSON. Every successful API request returns a <code>2xx</code> status code.</p>
<p>Invalid requests that reach the API handlers return a JSON error object and one of the following HTTP response codes:</p>
<ul>
<li><code>400 Bad Request</code> when parameters are missing or incorrect.</li>
<li><code>422 Unprocessable Entity</code> when an expression can’t be executed (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://tools.ietf.org/html/rfc4918#page-78">RFC4918</a>).</li>
<li><code>503 Service Unavailable</code> when queries time out or abort.</li>
</ul>
<p>Other non-<code>2xx</code> codes may be returned for errors occurring before the API endpoint is reached.</p>
<p>An array of warnings may be returned if there are errors that do not inhibit the request execution. All of the data that was successfully collected will be returned in the data field.</p>
<p>The JSON response envelope format is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot; | &quot;error&quot;,</span><br><span class="line">  &quot;data&quot;: &lt;data&gt;,</span><br><span class="line"></span><br><span class="line">  // Only set if status is &quot;error&quot;. The data field may still hold</span><br><span class="line">  // additional data.</span><br><span class="line">  &quot;errorType&quot;: &quot;&lt;string&gt;&quot;,</span><br><span class="line">  &quot;error&quot;: &quot;&lt;string&gt;&quot;,</span><br><span class="line"></span><br><span class="line">  // Only if there were warnings while executing the request.</span><br><span class="line">  // There will still be data in the data field.</span><br><span class="line">  &quot;warnings&quot;: [&quot;&lt;string&gt;&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Generic placeholders are defined as follows:</p>
<ul>
<li><code>&lt;rfc3339 | unix_timestamp&gt;</code>: Input timestamps may be provided either in <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.ietf.org/rfc/rfc3339.txt">RFC3339</a> format or as a Unix timestamp in seconds, with optional decimal places for sub-second precision. Output timestamps are always represented as Unix timestamps in seconds.</li>
<li><code>&lt;series_selector&gt;</code>: Prometheus <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/basics/#time-series-selectors">time series selectors</a> like <code>http_requests_total</code> or <code>http_requests_total&#123;method=~&quot;(GET|POST)&quot;&#125;</code> and need to be URL-encoded.</li>
<li><code>&lt;duration&gt;</code>: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/basics/#time-durations">Prometheus duration strings</a>. For example, <code>5m</code> refers to a duration of 5 minutes.</li>
<li><code>&lt;bool&gt;</code>: boolean values (strings <code>true</code> and <code>false</code>).</li>
</ul>
<p>Note: Names of query parameters that may be repeated end with <code>[]</code>.</p>
<h3 id="Expression-queries"><a href="#Expression-queries" class="headerlink" title="Expression queries"></a>Expression queries</h3><p>Query language expressions may be evaluated at a single instant or over a range of time. The sections below describe the API endpoints for each type of expression query.</p>
<h4 id="Instant-queries"><a href="#Instant-queries" class="headerlink" title="Instant queries"></a>Instant queries</h4><p>The following endpoint evaluates an instant query at a single point in time:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/query</span><br><span class="line">POST /api/v1/query</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>query=&lt;string&gt;</code>: Prometheus expression query string.</li>
<li><code>time=&lt;rfc3339 | unix_timestamp&gt;</code>: Evaluation timestamp. Optional.</li>
<li><code>timeout=&lt;duration&gt;</code>: Evaluation timeout. Optional. Defaults to and is capped by the value of the <code>-query.timeout</code> flag.</li>
</ul>
<p>The current server time is used if the <code>time</code> parameter is omitted.</p>
<p>You can URL-encode these parameters directly in the request body by using the <code>POST</code> method and <code>Content-Type: application/x-www-form-urlencoded</code> header. This is useful when specifying a large query that may breach server-side URL character limits.</p>
<p>The <code>data</code> section of the query result has the following format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;resultType&quot;: &quot;matrix&quot; | &quot;vector&quot; | &quot;scalar&quot; | &quot;string&quot;,</span><br><span class="line">  &quot;result&quot;: &lt;value&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>&lt;value&gt;</code> refers to the query result data, which has varying formats depending on the <code>resultType</code>. See the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/api/#expression-query-result-formats">expression query result formats</a>.</p>
<p>The following example evaluates the expression <code>up</code> at the time <code>2015-07-01T20:10:51.781Z</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ curl &#x27;http://localhost:9090/api/v1/query?query=up&amp;time=2015-07-01T20:10:51.781Z&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   &quot;status&quot; : &quot;success&quot;,</span><br><span class="line">   &quot;data&quot; : &#123;</span><br><span class="line">      &quot;resultType&quot; : &quot;vector&quot;,</span><br><span class="line">      &quot;result&quot; : [</span><br><span class="line">         &#123;</span><br><span class="line">            &quot;metric&quot; : &#123;</span><br><span class="line">               &quot;__name__&quot; : &quot;up&quot;,</span><br><span class="line">               &quot;job&quot; : &quot;prometheus&quot;,</span><br><span class="line">               &quot;instance&quot; : &quot;localhost:9090&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;value&quot;: [ 1435781451.781, &quot;1&quot; ]</span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">            &quot;metric&quot; : &#123;</span><br><span class="line">               &quot;__name__&quot; : &quot;up&quot;,</span><br><span class="line">               &quot;job&quot; : &quot;node&quot;,</span><br><span class="line">               &quot;instance&quot; : &quot;localhost:9100&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;value&quot; : [ 1435781451.781, &quot;0&quot; ]</span><br><span class="line">         &#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Range-queries"><a href="#Range-queries" class="headerlink" title="Range queries"></a>Range queries</h4><p>The following endpoint evaluates an expression query over a range of time:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/query_range</span><br><span class="line">POST /api/v1/query_range</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>query=&lt;string&gt;</code>: Prometheus expression query string.</li>
<li><code>start=&lt;rfc3339 | unix_timestamp&gt;</code>: Start timestamp, inclusive.</li>
<li><code>end=&lt;rfc3339 | unix_timestamp&gt;</code>: End timestamp, inclusive.</li>
<li><code>step=&lt;duration | float&gt;</code>: Query resolution step width in <code>duration</code> format or float number of seconds.</li>
<li><code>timeout=&lt;duration&gt;</code>: Evaluation timeout. Optional. Defaults to and is capped by the value of the <code>-query.timeout</code> flag.</li>
</ul>
<p>You can URL-encode these parameters directly in the request body by using the <code>POST</code> method and <code>Content-Type: application/x-www-form-urlencoded</code> header. This is useful when specifying a large query that may breach server-side URL character limits.</p>
<p>The <code>data</code> section of the query result has the following format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;resultType&quot;: &quot;matrix&quot;,</span><br><span class="line">  &quot;result&quot;: &lt;value&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For the format of the <code>&lt;value&gt;</code> placeholder, see the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/api/#range-vectors">range-vector result format</a>.</p>
<p>The following example evaluates the expression <code>up</code> over a 30-second range with a query resolution of 15 seconds.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ curl &#x27;http://localhost:9090/api/v1/query_range?query=up&amp;start=2015-07-01T20:10:30.781Z&amp;end=2015-07-01T20:11:00.781Z&amp;step=15s&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   &quot;status&quot; : &quot;success&quot;,</span><br><span class="line">   &quot;data&quot; : &#123;</span><br><span class="line">      &quot;resultType&quot; : &quot;matrix&quot;,</span><br><span class="line">      &quot;result&quot; : [</span><br><span class="line">         &#123;</span><br><span class="line">            &quot;metric&quot; : &#123;</span><br><span class="line">               &quot;__name__&quot; : &quot;up&quot;,</span><br><span class="line">               &quot;job&quot; : &quot;prometheus&quot;,</span><br><span class="line">               &quot;instance&quot; : &quot;localhost:9090&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;values&quot; : [</span><br><span class="line">               [ 1435781430.781, &quot;1&quot; ],</span><br><span class="line">               [ 1435781445.781, &quot;1&quot; ],</span><br><span class="line">               [ 1435781460.781, &quot;1&quot; ]</span><br><span class="line">            ]</span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">            &quot;metric&quot; : &#123;</span><br><span class="line">               &quot;__name__&quot; : &quot;up&quot;,</span><br><span class="line">               &quot;job&quot; : &quot;node&quot;,</span><br><span class="line">               &quot;instance&quot; : &quot;localhost:9091&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;values&quot; : [</span><br><span class="line">               [ 1435781430.781, &quot;0&quot; ],</span><br><span class="line">               [ 1435781445.781, &quot;0&quot; ],</span><br><span class="line">               [ 1435781460.781, &quot;1&quot; ]</span><br><span class="line">            ]</span><br><span class="line">         &#125;</span><br><span class="line">      ]</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Formatting-query-expressions"><a href="#Formatting-query-expressions" class="headerlink" title="Formatting query expressions"></a>Formatting query expressions</h3><p>The following endpoint formats a PromQL expression in a prettified way:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/format_query</span><br><span class="line">POST /api/v1/format_query</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>query=&lt;string&gt;</code>: Prometheus expression query string.</li>
</ul>
<p>You can URL-encode these parameters directly in the request body by using the <code>POST</code> method and <code>Content-Type: application/x-www-form-urlencoded</code> header. This is useful when specifying a large query that may breach server-side URL character limits.</p>
<p>The <code>data</code> section of the query result is a string containing the formatted query expression. Note that any comments are removed in the formatted string.</p>
<p>The following example formats the expression <code>foo/bar</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ curl &#x27;http://localhost:9090/api/v1/format_query?query=foo/bar&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   &quot;status&quot; : &quot;success&quot;,</span><br><span class="line">   &quot;data&quot; : &quot;foo / bar&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Querying-metadata"><a href="#Querying-metadata" class="headerlink" title="Querying metadata"></a>Querying metadata</h3><p>Prometheus offers a set of API endpoints to query metadata about series and their labels.</p>
<p><strong>NOTE:</strong> These API endpoints may return metadata for series for which there is no sample within the selected time range, and/or for series whose samples have been marked as deleted via the deletion API endpoint. The exact extent of additionally returned series metadata is an implementation detail that may change in the future.</p>
<h4 id="Finding-series-by-label-matchers"><a href="#Finding-series-by-label-matchers" class="headerlink" title="Finding series by label matchers"></a>Finding series by label matchers</h4><p>The following endpoint returns the list of time series that match a certain label set.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/series</span><br><span class="line">POST /api/v1/series</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>match[]=&lt;series_selector&gt;</code>: Repeated series selector argument that selects the series to return. At least one <code>match[]</code> argument must be provided.</li>
<li><code>start=&lt;rfc3339 | unix_timestamp&gt;</code>: Start timestamp.</li>
<li><code>end=&lt;rfc3339 | unix_timestamp&gt;</code>: End timestamp.</li>
</ul>
<p>You can URL-encode these parameters directly in the request body by using the <code>POST</code> method and <code>Content-Type: application/x-www-form-urlencoded</code> header. This is useful when specifying a large or dynamic number of series selectors that may breach server-side URL character limits.</p>
<p>The <code>data</code> section of the query result consists of a list of objects that contain the label name/value pairs which identify each series.</p>
<p>The following example returns all series that match either of the selectors <code>up</code> or <code>process_start_time_seconds&#123;job=&quot;prometheus&quot;&#125;</code>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ curl -g &#x27;http://localhost:9090/api/v1/series?&#x27; --data-urlencode &#x27;match[]=up&#x27; --data-urlencode &#x27;match[]=process_start_time_seconds&#123;job=&quot;prometheus&quot;&#125;&#x27;</span><br><span class="line">&#123;</span><br><span class="line">   &quot;status&quot; : &quot;success&quot;,</span><br><span class="line">   &quot;data&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;__name__&quot; : &quot;up&quot;,</span><br><span class="line">         &quot;job&quot; : &quot;prometheus&quot;,</span><br><span class="line">         &quot;instance&quot; : &quot;localhost:9090&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;__name__&quot; : &quot;up&quot;,</span><br><span class="line">         &quot;job&quot; : &quot;node&quot;,</span><br><span class="line">         &quot;instance&quot; : &quot;localhost:9091&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">         &quot;__name__&quot; : &quot;process_start_time_seconds&quot;,</span><br><span class="line">         &quot;job&quot; : &quot;prometheus&quot;,</span><br><span class="line">         &quot;instance&quot; : &quot;localhost:9090&quot;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Getting-label-names"><a href="#Getting-label-names" class="headerlink" title="Getting label names"></a>Getting label names</h4><p>The following endpoint returns a list of label names:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/labels</span><br><span class="line">POST /api/v1/labels</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>start=&lt;rfc3339 | unix_timestamp&gt;</code>: Start timestamp. Optional.</li>
<li><code>end=&lt;rfc3339 | unix_timestamp&gt;</code>: End timestamp. Optional.</li>
<li><code>match[]=&lt;series_selector&gt;</code>: Repeated series selector argument that selects the series from which to read the label names. Optional.</li>
</ul>
<p>The <code>data</code> section of the JSON response is a list of string label names.</p>
<p>Here is an example.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">$ curl &#x27;localhost:9090/api/v1/labels&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">    &quot;data&quot;: [</span><br><span class="line">        &quot;__name__&quot;,</span><br><span class="line">        &quot;call&quot;,</span><br><span class="line">        &quot;code&quot;,</span><br><span class="line">        &quot;config&quot;,</span><br><span class="line">        &quot;dialer_name&quot;,</span><br><span class="line">        &quot;endpoint&quot;,</span><br><span class="line">        &quot;event&quot;,</span><br><span class="line">        &quot;goversion&quot;,</span><br><span class="line">        &quot;handler&quot;,</span><br><span class="line">        &quot;instance&quot;,</span><br><span class="line">        &quot;interval&quot;,</span><br><span class="line">        &quot;job&quot;,</span><br><span class="line">        &quot;le&quot;,</span><br><span class="line">        &quot;listener_name&quot;,</span><br><span class="line">        &quot;name&quot;,</span><br><span class="line">        &quot;quantile&quot;,</span><br><span class="line">        &quot;reason&quot;,</span><br><span class="line">        &quot;role&quot;,</span><br><span class="line">        &quot;scrape_job&quot;,</span><br><span class="line">        &quot;slice&quot;,</span><br><span class="line">        &quot;version&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Querying-label-values"><a href="#Querying-label-values" class="headerlink" title="Querying label values"></a>Querying label values</h4><p>The following endpoint returns a list of label values for a provided label name:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/label/&lt;label_name&gt;/values</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>start=&lt;rfc3339 | unix_timestamp&gt;</code>: Start timestamp. Optional.</li>
<li><code>end=&lt;rfc3339 | unix_timestamp&gt;</code>: End timestamp. Optional.</li>
<li><code>match[]=&lt;series_selector&gt;</code>: Repeated series selector argument that selects the series from which to read the label values. Optional.</li>
</ul>
<p>The <code>data</code> section of the JSON response is a list of string label values.</p>
<p>This example queries for all label values for the <code>job</code> label:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/label/job/values</span><br><span class="line">&#123;</span><br><span class="line">   &quot;status&quot; : &quot;success&quot;,</span><br><span class="line">   &quot;data&quot; : [</span><br><span class="line">      &quot;node&quot;,</span><br><span class="line">      &quot;prometheus&quot;</span><br><span class="line">   ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Querying-exemplars"><a href="#Querying-exemplars" class="headerlink" title="Querying exemplars"></a>Querying exemplars</h3><p>This is <strong>experimental</strong> and might change in the future. The following endpoint returns a list of exemplars for a valid PromQL query for a specific time range:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/query_exemplars</span><br><span class="line">POST /api/v1/query_exemplars</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>query=&lt;string&gt;</code>: Prometheus expression query string.</li>
<li><code>start=&lt;rfc3339 | unix_timestamp&gt;</code>: Start timestamp.</li>
<li><code>end=&lt;rfc3339 | unix_timestamp&gt;</code>: End timestamp.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ curl -g &#x27;http://localhost:9090/api/v1/query_exemplars?query=test_exemplar_metric_total&amp;start=2020-09-14T15:22:25.479Z&amp;end=2020-09-14T15:23:25.479Z&#x27;</span><br><span class="line">&#123;</span><br><span class="line">    &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">    &quot;data&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;seriesLabels&quot;: &#123;</span><br><span class="line">                &quot;__name__&quot;: &quot;test_exemplar_metric_total&quot;,</span><br><span class="line">                &quot;instance&quot;: &quot;localhost:8090&quot;,</span><br><span class="line">                &quot;job&quot;: &quot;prometheus&quot;,</span><br><span class="line">                &quot;service&quot;: &quot;bar&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;exemplars&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;labels&quot;: &#123;</span><br><span class="line">                        &quot;traceID&quot;: &quot;EpTxMJ40fUus7aGY&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;value&quot;: &quot;6&quot;,</span><br><span class="line">                    &quot;timestamp&quot;: 1600096945.479,</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;seriesLabels&quot;: &#123;</span><br><span class="line">                &quot;__name__&quot;: &quot;test_exemplar_metric_total&quot;,</span><br><span class="line">                &quot;instance&quot;: &quot;localhost:8090&quot;,</span><br><span class="line">                &quot;job&quot;: &quot;prometheus&quot;,</span><br><span class="line">                &quot;service&quot;: &quot;foo&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;exemplars&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;labels&quot;: &#123;</span><br><span class="line">                        &quot;traceID&quot;: &quot;Olp9XHlq763ccsfa&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;value&quot;: &quot;19&quot;,</span><br><span class="line">                    &quot;timestamp&quot;: 1600096955.479,</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;labels&quot;: &#123;</span><br><span class="line">                        &quot;traceID&quot;: &quot;hCtjygkIHwAN9vs4&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &quot;value&quot;: &quot;20&quot;,</span><br><span class="line">                    &quot;timestamp&quot;: 1600096965.489,</span><br><span class="line">                &#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Expression-query-result-formats"><a href="#Expression-query-result-formats" class="headerlink" title="Expression query result formats"></a>Expression query result formats</h3><p>Expression queries may return the following response values in the <code>result</code> property of the <code>data</code> section. <code>&lt;sample_value&gt;</code> placeholders are numeric sample values. JSON does not support special float values such as <code>NaN</code>, <code>Inf</code>, and <code>-Inf</code>, so sample values are transferred as quoted JSON strings rather than raw numbers.</p>
<p>The keys <code>&quot;histogram&quot;</code> and <code>&quot;histograms&quot;</code> only show up if the experimental native histograms are present in the response. Their placeholder <code>&lt;histogram&gt;</code> is explained in detail in its own section below.</p>
<h4 id="Range-vectors"><a href="#Range-vectors" class="headerlink" title="Range vectors"></a>Range vectors</h4><p>Range vectors are returned as result type <code>matrix</code>. The corresponding <code>result</code> property has the following format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;metric&quot;: &#123; &quot;&lt;label_name&gt;&quot;: &quot;&lt;label_value&gt;&quot;, ... &#125;,</span><br><span class="line">    &quot;values&quot;: [ [ &lt;unix_time&gt;, &quot;&lt;sample_value&gt;&quot; ], ... ],</span><br><span class="line">    &quot;histograms&quot;: [ [ &lt;unix_time&gt;, &lt;histogram&gt; ], ... ]</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Each series could have the <code>&quot;values&quot;</code> key, or the <code>&quot;histograms&quot;</code> key, or both. For a given timestamp, there will only be one sample of either float or histogram type.</p>
<h4 id="Instant-vectors"><a href="#Instant-vectors" class="headerlink" title="Instant vectors"></a>Instant vectors</h4><p>Instant vectors are returned as result type <code>vector</code>. The corresponding <code>result</code> property has the following format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;metric&quot;: &#123; &quot;&lt;label_name&gt;&quot;: &quot;&lt;label_value&gt;&quot;, ... &#125;,</span><br><span class="line">    &quot;value&quot;: [ &lt;unix_time&gt;, &quot;&lt;sample_value&gt;&quot; ],</span><br><span class="line">    &quot;histogram&quot;: [ &lt;unix_time&gt;, &lt;histogram&gt; ]</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Each series could have the <code>&quot;value&quot;</code> key, or the <code>&quot;histogram&quot;</code> key, but not both.</p>
<h4 id="Scalars"><a href="#Scalars" class="headerlink" title="Scalars"></a>Scalars</h4><p>Scalar results are returned as result type <code>scalar</code>. The corresponding <code>result</code> property has the following format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ &lt;unix_time&gt;, &quot;&lt;scalar_value&gt;&quot; ]</span><br></pre></td></tr></table></figure>
<h4 id="Strings"><a href="#Strings" class="headerlink" title="Strings"></a>Strings</h4><p>String results are returned as result type <code>string</code>. The corresponding <code>result</code> property has the following format:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[ &lt;unix_time&gt;, &quot;&lt;string_value&gt;&quot; ]</span><br></pre></td></tr></table></figure>
<h4 id="Native-histograms"><a href="#Native-histograms" class="headerlink" title="Native histograms"></a>Native histograms</h4><p>The <code>&lt;histogram&gt;</code> placeholder used above is formatted as follows.</p>
<p><em>Note that native histograms are an experimental feature, and the format below might still change.</em></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;count&quot;: &quot;&lt;count_of_observations&gt;&quot;,</span><br><span class="line">  &quot;sum&quot;: &quot;&lt;sum_of_observations&gt;&quot;,</span><br><span class="line">  &quot;buckets&quot;: [ [ &lt;boundary_rule&gt;, &quot;&lt;left_boundary&gt;&quot;, &quot;&lt;right_boundary&gt;&quot;, &quot;&lt;count_in_bucket&gt;&quot; ], ... ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>&lt;boundary_rule&gt;</code> placeholder is an integer between 0 and 3 with the following meaning:</p>
<ul>
<li>0: “open left” (left boundary is exclusive, right boundary in inclusive)</li>
<li>1: “open right” (left boundary is inclusive, right boundary in exclusive)</li>
<li>2: “open both” (both boundaries are exclusive)</li>
<li>3: “closed both” (both boundaries are inclusive)</li>
</ul>
<p>Note that with the currently implemented bucket schemas, positive buckets are “open left”, negative buckets are “open right”, and the zero bucket (with a negative left boundary and a positive right boundary) is “closed both”.</p>
<h3 id="Targets"><a href="#Targets" class="headerlink" title="Targets"></a>Targets</h3><p>The following endpoint returns an overview of the current state of the Prometheus target discovery:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/targets</span><br></pre></td></tr></table></figure>
<p>Both the active and dropped targets are part of the response by default. <code>labels</code> represents the label set after relabeling has occurred. <code>discoveredLabels</code> represent the unmodified labels retrieved during service discovery before relabeling has occurred.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/targets</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;activeTargets&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;discoveredLabels&quot;: &#123;</span><br><span class="line">          &quot;__address__&quot;: &quot;127.0.0.1:9090&quot;,</span><br><span class="line">          &quot;__metrics_path__&quot;: &quot;/metrics&quot;,</span><br><span class="line">          &quot;__scheme__&quot;: &quot;http&quot;,</span><br><span class="line">          &quot;job&quot;: &quot;prometheus&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;labels&quot;: &#123;</span><br><span class="line">          &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br><span class="line">          &quot;job&quot;: &quot;prometheus&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;scrapePool&quot;: &quot;prometheus&quot;,</span><br><span class="line">        &quot;scrapeUrl&quot;: &quot;http://127.0.0.1:9090/metrics&quot;,</span><br><span class="line">        &quot;globalUrl&quot;: &quot;http://example-prometheus:9090/metrics&quot;,</span><br><span class="line">        &quot;lastError&quot;: &quot;&quot;,</span><br><span class="line">        &quot;lastScrape&quot;: &quot;2017-01-17T15:07:44.723715405+01:00&quot;,</span><br><span class="line">        &quot;lastScrapeDuration&quot;: 0.050688943,</span><br><span class="line">        &quot;health&quot;: &quot;up&quot;,</span><br><span class="line">        &quot;scrapeInterval&quot;: &quot;1m&quot;,</span><br><span class="line">        &quot;scrapeTimeout&quot;: &quot;10s&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;droppedTargets&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;discoveredLabels&quot;: &#123;</span><br><span class="line">          &quot;__address__&quot;: &quot;127.0.0.1:9100&quot;,</span><br><span class="line">          &quot;__metrics_path__&quot;: &quot;/metrics&quot;,</span><br><span class="line">          &quot;__scheme__&quot;: &quot;http&quot;,</span><br><span class="line">          &quot;__scrape_interval__&quot;: &quot;1m&quot;,</span><br><span class="line">          &quot;__scrape_timeout__&quot;: &quot;10s&quot;,</span><br><span class="line">          &quot;job&quot;: &quot;node&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>state</code> query parameter allows the caller to filter by active or dropped targets, (e.g., <code>state=active</code>, <code>state=dropped</code>, <code>state=any</code>). Note that an empty array is still returned for targets that are filtered out. Other values are ignored.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ curl &#x27;http://localhost:9090/api/v1/targets?state=active&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;activeTargets&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;discoveredLabels&quot;: &#123;</span><br><span class="line">          &quot;__address__&quot;: &quot;127.0.0.1:9090&quot;,</span><br><span class="line">          &quot;__metrics_path__&quot;: &quot;/metrics&quot;,</span><br><span class="line">          &quot;__scheme__&quot;: &quot;http&quot;,</span><br><span class="line">          &quot;job&quot;: &quot;prometheus&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;labels&quot;: &#123;</span><br><span class="line">          &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br><span class="line">          &quot;job&quot;: &quot;prometheus&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;scrapePool&quot;: &quot;prometheus&quot;,</span><br><span class="line">        &quot;scrapeUrl&quot;: &quot;http://127.0.0.1:9090/metrics&quot;,</span><br><span class="line">        &quot;globalUrl&quot;: &quot;http://example-prometheus:9090/metrics&quot;,</span><br><span class="line">        &quot;lastError&quot;: &quot;&quot;,</span><br><span class="line">        &quot;lastScrape&quot;: &quot;2017-01-17T15:07:44.723715405+01:00&quot;,</span><br><span class="line">        &quot;lastScrapeDuration&quot;: 50688943,</span><br><span class="line">        &quot;health&quot;: &quot;up&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;droppedTargets&quot;: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <code>scrapePool</code> query parameter allows the caller to filter by scrape pool name.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">$ curl &#x27;http://localhost:9090/api/v1/targets?scrapePool=node_exporter&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;activeTargets&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;discoveredLabels&quot;: &#123;</span><br><span class="line">          &quot;__address__&quot;: &quot;127.0.0.1:9091&quot;,</span><br><span class="line">          &quot;__metrics_path__&quot;: &quot;/metrics&quot;,</span><br><span class="line">          &quot;__scheme__&quot;: &quot;http&quot;,</span><br><span class="line">          &quot;job&quot;: &quot;node_exporter&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;labels&quot;: &#123;</span><br><span class="line">          &quot;instance&quot;: &quot;127.0.0.1:9091&quot;,</span><br><span class="line">          &quot;job&quot;: &quot;node_exporter&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;scrapePool&quot;: &quot;node_exporter&quot;,</span><br><span class="line">        &quot;scrapeUrl&quot;: &quot;http://127.0.0.1:9091/metrics&quot;,</span><br><span class="line">        &quot;globalUrl&quot;: &quot;http://example-prometheus:9091/metrics&quot;,</span><br><span class="line">        &quot;lastError&quot;: &quot;&quot;,</span><br><span class="line">        &quot;lastScrape&quot;: &quot;2017-01-17T15:07:44.723715405+01:00&quot;,</span><br><span class="line">        &quot;lastScrapeDuration&quot;: 50688943,</span><br><span class="line">        &quot;health&quot;: &quot;up&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;droppedTargets&quot;: []</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Rules"><a href="#Rules" class="headerlink" title="Rules"></a>Rules</h3><p>The <code>/rules</code> API endpoint returns a list of alerting and recording rules that are currently loaded. In addition it returns the currently active alerts fired by the Prometheus instance of each alerting rule.</p>
<p>As the <code>/rules</code> endpoint is fairly new, it does not have the same stability guarantees as the overarching API v1.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/rules</span><br></pre></td></tr></table></figure>
<p>URL query parameters: - <code>type=alert|record</code>: return only the alerting rules (e.g. <code>type=alert</code>) or the recording rules (e.g. <code>type=record</code>). When the parameter is absent or empty, no filtering is done.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/rules</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;groups&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;rules&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;alerts&quot;: [</span><br><span class="line">                            &#123;</span><br><span class="line">                                &quot;activeAt&quot;: &quot;2018-07-04T20:27:12.60602144+02:00&quot;,</span><br><span class="line">                                &quot;annotations&quot;: &#123;</span><br><span class="line">                                    &quot;summary&quot;: &quot;High request latency&quot;</span><br><span class="line">                                &#125;,</span><br><span class="line">                                &quot;labels&quot;: &#123;</span><br><span class="line">                                    &quot;alertname&quot;: &quot;HighRequestLatency&quot;,</span><br><span class="line">                                    &quot;severity&quot;: &quot;page&quot;</span><br><span class="line">                                &#125;,</span><br><span class="line">                                &quot;state&quot;: &quot;firing&quot;,</span><br><span class="line">                                &quot;value&quot;: &quot;1e+00&quot;</span><br><span class="line">                            &#125;</span><br><span class="line">                        ],</span><br><span class="line">                        &quot;annotations&quot;: &#123;</span><br><span class="line">                            &quot;summary&quot;: &quot;High request latency&quot;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;duration&quot;: 600,</span><br><span class="line">                        &quot;health&quot;: &quot;ok&quot;,</span><br><span class="line">                        &quot;labels&quot;: &#123;</span><br><span class="line">                            &quot;severity&quot;: &quot;page&quot;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        &quot;name&quot;: &quot;HighRequestLatency&quot;,</span><br><span class="line">                        &quot;query&quot;: &quot;job:request_latency_seconds:mean5m&#123;job=\&quot;myjob\&quot;&#125; &gt; 0.5&quot;,</span><br><span class="line">                        &quot;type&quot;: &quot;alerting&quot;</span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;health&quot;: &quot;ok&quot;,</span><br><span class="line">                        &quot;name&quot;: &quot;job:http_inprogress_requests:sum&quot;,</span><br><span class="line">                        &quot;query&quot;: &quot;sum by (job) (http_inprogress_requests)&quot;,</span><br><span class="line">                        &quot;type&quot;: &quot;recording&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                &quot;file&quot;: &quot;/rules.yaml&quot;,</span><br><span class="line">                &quot;interval&quot;: 60,</span><br><span class="line">                &quot;limit&quot;: 0,</span><br><span class="line">                &quot;name&quot;: &quot;example&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;status&quot;: &quot;success&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Alerts"><a href="#Alerts" class="headerlink" title="Alerts"></a>Alerts</h3><p>The <code>/alerts</code> endpoint returns a list of all active alerts.</p>
<p>As the <code>/alerts</code> endpoint is fairly new, it does not have the same stability guarantees as the overarching API v1.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/alerts</span><br><span class="line">$ curl http://localhost:9090/api/v1/alerts</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    &quot;data&quot;: &#123;</span><br><span class="line">        &quot;alerts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;activeAt&quot;: &quot;2018-07-04T20:27:12.60602144+02:00&quot;,</span><br><span class="line">                &quot;annotations&quot;: &#123;&#125;,</span><br><span class="line">                &quot;labels&quot;: &#123;</span><br><span class="line">                    &quot;alertname&quot;: &quot;my-alert&quot;</span><br><span class="line">                &#125;,</span><br><span class="line">                &quot;state&quot;: &quot;firing&quot;,</span><br><span class="line">                &quot;value&quot;: &quot;1e+00&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;status&quot;: &quot;success&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Querying-target-metadata"><a href="#Querying-target-metadata" class="headerlink" title="Querying target metadata"></a>Querying target metadata</h3><p>The following endpoint returns metadata about metrics currently scraped from targets. This is <strong>experimental</strong> and might change in the future.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/targets/metadata</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>match_target=&lt;label_selectors&gt;</code>: Label selectors that match targets by their label sets. All targets are selected if left empty.</li>
<li><code>metric=&lt;string&gt;</code>: A metric name to retrieve metadata for. All metric metadata is retrieved if left empty.</li>
<li><code>limit=&lt;number&gt;</code>: Maximum number of targets to match.</li>
</ul>
<p>The <code>data</code> section of the query result consists of a list of objects that contain metric metadata and the target label set.</p>
<p>The following example returns all metadata entries for the <code>go_goroutines</code> metric from the first two targets with label <code>job=&quot;prometheus&quot;</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">curl -G http://localhost:9091/api/v1/targets/metadata \</span><br><span class="line">    --data-urlencode &#x27;metric=go_goroutines&#x27; \</span><br><span class="line">    --data-urlencode &#x27;match_target=&#123;job=&quot;prometheus&quot;&#125;&#x27; \</span><br><span class="line">    --data-urlencode &#x27;limit=2&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;target&quot;: &#123;</span><br><span class="line">        &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br><span class="line">        &quot;job&quot;: &quot;prometheus&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;type&quot;: &quot;gauge&quot;,</span><br><span class="line">      &quot;help&quot;: &quot;Number of goroutines that currently exist.&quot;,</span><br><span class="line">      &quot;unit&quot;: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;target&quot;: &#123;</span><br><span class="line">        &quot;instance&quot;: &quot;127.0.0.1:9091&quot;,</span><br><span class="line">        &quot;job&quot;: &quot;prometheus&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;type&quot;: &quot;gauge&quot;,</span><br><span class="line">      &quot;help&quot;: &quot;Number of goroutines that currently exist.&quot;,</span><br><span class="line">      &quot;unit&quot;: &quot;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The following example returns metadata for all metrics for all targets with label <code>instance=&quot;127.0.0.1:9090</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">curl -G http://localhost:9091/api/v1/targets/metadata \</span><br><span class="line">    --data-urlencode &#x27;match_target=&#123;instance=&quot;127.0.0.1:9090&quot;&#125;&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: [</span><br><span class="line">    // ...</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;target&quot;: &#123;</span><br><span class="line">        &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br><span class="line">        &quot;job&quot;: &quot;prometheus&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;metric&quot;: &quot;prometheus_treecache_zookeeper_failures_total&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;counter&quot;,</span><br><span class="line">      &quot;help&quot;: &quot;The total number of ZooKeeper failures.&quot;,</span><br><span class="line">      &quot;unit&quot;: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;target&quot;: &#123;</span><br><span class="line">        &quot;instance&quot;: &quot;127.0.0.1:9090&quot;,</span><br><span class="line">        &quot;job&quot;: &quot;prometheus&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;metric&quot;: &quot;prometheus_tsdb_reloads_total&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;counter&quot;,</span><br><span class="line">      &quot;help&quot;: &quot;Number of times the database reloaded block data from disk.&quot;,</span><br><span class="line">      &quot;unit&quot;: &quot;&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    // ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Querying-metric-metadata"><a href="#Querying-metric-metadata" class="headerlink" title="Querying metric metadata"></a>Querying metric metadata</h3><p>It returns metadata about metrics currently scraped from targets. However, it does not provide any target information. This is considered <strong>experimental</strong> and might change in the future.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/metadata</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>limit=&lt;number&gt;</code>: Maximum number of metrics to return.</li>
<li><code>metric=&lt;string&gt;</code>: A metric name to filter metadata for. All metric metadata is retrieved if left empty.</li>
</ul>
<p>The <code>data</code> section of the query result consists of an object where each key is a metric name and each value is a list of unique metadata objects, as exposed for that metric name across all targets.</p>
<p>The following example returns two metrics. Note that the metric <code>http_requests_total</code> has more than one object in the list. At least one target has a value for <code>HELP</code> that do not match with the rest.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">curl -G http://localhost:9090/api/v1/metadata?limit=2</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;cortex_ring_tokens&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;gauge&quot;,</span><br><span class="line">        &quot;help&quot;: &quot;Number of tokens in the ring&quot;,</span><br><span class="line">        &quot;unit&quot;: &quot;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;http_requests_total&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;counter&quot;,</span><br><span class="line">        &quot;help&quot;: &quot;Number of HTTP requests&quot;,</span><br><span class="line">        &quot;unit&quot;: &quot;&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;counter&quot;,</span><br><span class="line">        &quot;help&quot;: &quot;Amount of HTTP requests&quot;,</span><br><span class="line">        &quot;unit&quot;: &quot;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The following example returns metadata only for the metric <code>http_requests_total</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">curl -G http://localhost:9090/api/v1/metadata?metric=http_requests_total</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;http_requests_total&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;counter&quot;,</span><br><span class="line">        &quot;help&quot;: &quot;Number of HTTP requests&quot;,</span><br><span class="line">        &quot;unit&quot;: &quot;&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;counter&quot;,</span><br><span class="line">        &quot;help&quot;: &quot;Amount of HTTP requests&quot;,</span><br><span class="line">        &quot;unit&quot;: &quot;&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Alertmanagers"><a href="#Alertmanagers" class="headerlink" title="Alertmanagers"></a>Alertmanagers</h3><p>The following endpoint returns an overview of the current state of the Prometheus alertmanager discovery:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/alertmanagers</span><br></pre></td></tr></table></figure>
<p>Both the active and dropped Alertmanagers are part of the response.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/alertmanagers</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;activeAlertmanagers&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;url&quot;: &quot;http://127.0.0.1:9090/api/v1/alerts&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;droppedAlertmanagers&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;url&quot;: &quot;http://127.0.0.1:9093/api/v1/alerts&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Status"><a href="#Status" class="headerlink" title="Status"></a>Status</h3><p>Following status endpoints expose current Prometheus configuration.</p>
<h4 id="Config"><a href="#Config" class="headerlink" title="Config"></a>Config</h4><p>The following endpoint returns currently loaded configuration file:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/status/config</span><br></pre></td></tr></table></figure>
<p>The config is returned as dumped YAML file. Due to limitation of the YAML library, YAML comments are not included.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/status/config</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;yaml&quot;: &quot;&lt;content of the loaded config file in YAML&gt;&quot;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Flags"><a href="#Flags" class="headerlink" title="Flags"></a>Flags</h4><p>The following endpoint returns flag values that Prometheus was configured with:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/status/flags</span><br></pre></td></tr></table></figure>
<p>All values are of the result type <code>string</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/status/flags</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;alertmanager.notification-queue-capacity&quot;: &quot;10000&quot;,</span><br><span class="line">    &quot;alertmanager.timeout&quot;: &quot;10s&quot;,</span><br><span class="line">    &quot;log.level&quot;: &quot;info&quot;,</span><br><span class="line">    &quot;query.lookback-delta&quot;: &quot;5m&quot;,</span><br><span class="line">    &quot;query.max-concurrency&quot;: &quot;20&quot;,</span><br><span class="line">    ...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>New in v2.2</em></p>
<h4 id="Runtime-Information"><a href="#Runtime-Information" class="headerlink" title="Runtime Information"></a>Runtime Information</h4><p>The following endpoint returns various runtime information properties about the Prometheus server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/status/runtimeinfo</span><br></pre></td></tr></table></figure>
<p>The returned values are of different types, depending on the nature of the runtime property.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/status/runtimeinfo</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;startTime&quot;: &quot;2019-11-02T17:23:59.301361365+01:00&quot;,</span><br><span class="line">    &quot;CWD&quot;: &quot;/&quot;,</span><br><span class="line">    &quot;reloadConfigSuccess&quot;: true,</span><br><span class="line">    &quot;lastConfigTime&quot;: &quot;2019-11-02T17:23:59+01:00&quot;,</span><br><span class="line">    &quot;timeSeriesCount&quot;: 873,</span><br><span class="line">    &quot;corruptionCount&quot;: 0,</span><br><span class="line">    &quot;goroutineCount&quot;: 48,</span><br><span class="line">    &quot;GOMAXPROCS&quot;: 4,</span><br><span class="line">    &quot;GOGC&quot;: &quot;&quot;,</span><br><span class="line">    &quot;GODEBUG&quot;: &quot;&quot;,</span><br><span class="line">    &quot;storageRetention&quot;: &quot;15d&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>NOTE:</strong> The exact returned runtime properties may change without notice between Prometheus versions.</p>
<p><em>New in v2.14</em></p>
<h4 id="Build-Information"><a href="#Build-Information" class="headerlink" title="Build Information"></a>Build Information</h4><p>The following endpoint returns various build information properties about the Prometheus server:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/status/buildinfo</span><br></pre></td></tr></table></figure>
<p>All values are of the result type <code>string</code>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/status/buildinfo</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;version&quot;: &quot;2.13.1&quot;,</span><br><span class="line">    &quot;revision&quot;: &quot;cb7cbad5f9a2823a622aaa668833ca04f50a0ea7&quot;,</span><br><span class="line">    &quot;branch&quot;: &quot;master&quot;,</span><br><span class="line">    &quot;buildUser&quot;: &quot;julius@desktop&quot;,</span><br><span class="line">    &quot;buildDate&quot;: &quot;20191102-16:19:59&quot;,</span><br><span class="line">    &quot;goVersion&quot;: &quot;go1.13.1&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>NOTE:</strong> The exact returned build properties may change without notice between Prometheus versions.</p>
<p><em>New in v2.14</em></p>
<h4 id="TSDB-Stats"><a href="#TSDB-Stats" class="headerlink" title="TSDB Stats"></a>TSDB Stats</h4><p>The following endpoint returns various cardinality statistics about the Prometheus TSDB:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/status/tsdb</span><br></pre></td></tr></table></figure>
<ul>
<li><p>headStats</p>
<p>: This provides the following data about the head block of the TSDB:</p>
<ul>
<li><strong>numSeries</strong>: The number of series.</li>
<li><strong>chunkCount</strong>: The number of chunks.</li>
<li><strong>minTime</strong>: The current minimum timestamp in milliseconds.</li>
<li><strong>maxTime</strong>: The current maximum timestamp in milliseconds.</li>
</ul>
</li>
<li><p><strong>seriesCountByMetricName:</strong> This will provide a list of metrics names and their series count.</p>
</li>
<li><p><strong>labelValueCountByLabelName:</strong> This will provide a list of the label names and their value count.</p>
</li>
<li><p><strong>memoryInBytesByLabelName</strong> This will provide a list of the label names and memory used in bytes. Memory usage is calculated by adding the length of all values for a given label name.</p>
</li>
<li><p><strong>seriesCountByLabelPair</strong> This will provide a list of label value pairs and their series count.</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/status/tsdb</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;headStats&quot;: &#123;</span><br><span class="line">      &quot;numSeries&quot;: 508,</span><br><span class="line">      &quot;chunkCount&quot;: 937,</span><br><span class="line">      &quot;minTime&quot;: 1591516800000,</span><br><span class="line">      &quot;maxTime&quot;: 1598896800143,</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;seriesCountByMetricName&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;net_conntrack_dialer_conn_failed_total&quot;,</span><br><span class="line">        &quot;value&quot;: 20</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;prometheus_http_request_duration_seconds_bucket&quot;,</span><br><span class="line">        &quot;value&quot;: 20</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;labelValueCountByLabelName&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;__name__&quot;,</span><br><span class="line">        &quot;value&quot;: 211</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;event&quot;,</span><br><span class="line">        &quot;value&quot;: 3</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;memoryInBytesByLabelName&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;__name__&quot;,</span><br><span class="line">        &quot;value&quot;: 8266</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;instance&quot;,</span><br><span class="line">        &quot;value&quot;: 28</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;seriesCountByLabelValuePair&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;job=prometheus&quot;,</span><br><span class="line">        &quot;value&quot;: 425</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;name&quot;: &quot;instance=localhost:9090&quot;,</span><br><span class="line">        &quot;value&quot;: 425</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><em>New in v2.15</em></p>
<h4 id="WAL-Replay-Stats"><a href="#WAL-Replay-Stats" class="headerlink" title="WAL Replay Stats"></a>WAL Replay Stats</h4><p>The following endpoint returns information about the WAL replay:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /api/v1/status/walreplay</span><br></pre></td></tr></table></figure>
<p><strong>read</strong>: The number of segments replayed so far. <strong>total</strong>: The total number segments needed to be replayed. <strong>progress</strong>: The progress of the replay (0 - 100%). <strong>state</strong>: The state of the replay. Possible states: - <strong>waiting</strong>: Waiting for the replay to start. - <strong>in progress</strong>: The replay is in progress. - <strong>done</strong>: The replay has finished.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ curl http://localhost:9090/api/v1/status/walreplay</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;min&quot;: 2,</span><br><span class="line">    &quot;max&quot;: 5,</span><br><span class="line">    &quot;current&quot;: 40,</span><br><span class="line">    &quot;state&quot;: &quot;in progress&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>NOTE:</strong> This endpoint is available before the server has been marked ready and is updated in real time to facilitate monitoring the progress of the WAL replay.</p>
<p><em>New in v2.28</em></p>
<h3 id="TSDB-Admin-APIs"><a href="#TSDB-Admin-APIs" class="headerlink" title="TSDB Admin APIs"></a>TSDB Admin APIs</h3><p>These are APIs that expose database functionalities for the advanced user. These APIs are not enabled unless the <code>--web.enable-admin-api</code> is set.</p>
<h4 id="Snapshot"><a href="#Snapshot" class="headerlink" title="Snapshot"></a>Snapshot</h4><p>Snapshot creates a snapshot of all current data into <code>snapshots/&lt;datetime&gt;-&lt;rand&gt;</code> under the TSDB’s data directory and returns the directory as response. It will optionally skip snapshotting data that is only present in the head block, and which has not yet been compacted to disk.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/admin/tsdb/snapshot</span><br><span class="line">PUT /api/v1/admin/tsdb/snapshot</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>skip_head=&lt;bool&gt;</code>: Skip data present in the head block. Optional.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ curl -XPOST http://localhost:9090/api/v1/admin/tsdb/snapshot</span><br><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot;,</span><br><span class="line">  &quot;data&quot;: &#123;</span><br><span class="line">    &quot;name&quot;: &quot;20171210T211224Z-2be650b6d019eb54&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The snapshot now exists at <code>&lt;data-dir&gt;/snapshots/20171210T211224Z-2be650b6d019eb54</code></p>
<p><em>New in v2.1 and supports PUT from v2.9</em></p>
<h4 id="Delete-Series"><a href="#Delete-Series" class="headerlink" title="Delete Series"></a>Delete Series</h4><p>DeleteSeries deletes data for a selection of series in a time range. The actual data still exists on disk and is cleaned up in future compactions or can be explicitly cleaned up by hitting the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/api/#clean-tombstones">Clean Tombstones</a> endpoint.</p>
<p>If successful, a <code>204</code> is returned.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/admin/tsdb/delete_series</span><br><span class="line">PUT /api/v1/admin/tsdb/delete_series</span><br></pre></td></tr></table></figure>
<p>URL query parameters:</p>
<ul>
<li><code>match[]=&lt;series_selector&gt;</code>: Repeated label matcher argument that selects the series to delete. At least one <code>match[]</code> argument must be provided.</li>
<li><code>start=&lt;rfc3339 | unix_timestamp&gt;</code>: Start timestamp. Optional and defaults to minimum possible time.</li>
<li><code>end=&lt;rfc3339 | unix_timestamp&gt;</code>: End timestamp. Optional and defaults to maximum possible time.</li>
</ul>
<p>Not mentioning both start and end times would clear all the data for the matched series in the database.</p>
<p>Example:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl -X POST \</span><br><span class="line">  -g &#x27;http://localhost:9090/api/v1/admin/tsdb/delete_series?match[]=up&amp;match[]=process_start_time_seconds&#123;job=&quot;prometheus&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure>
<p><strong>NOTE:</strong> This endpoint marks samples from series as deleted, but will not necessarily prevent associated series metadata from still being returned in metadata queries for the affected time range (even after cleaning tombstones). The exact extent of metadata deletion is an implementation detail that may change in the future.</p>
<p><em>New in v2.1 and supports PUT from v2.9</em></p>
<h4 id="Clean-Tombstones"><a href="#Clean-Tombstones" class="headerlink" title="Clean Tombstones"></a>Clean Tombstones</h4><p>CleanTombstones removes the deleted data from disk and cleans up the existing tombstones. This can be used after deleting series to free up space.</p>
<p>If successful, a <code>204</code> is returned.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /api/v1/admin/tsdb/clean_tombstones</span><br><span class="line">PUT /api/v1/admin/tsdb/clean_tombstones</span><br></pre></td></tr></table></figure>
<p>This takes no parameters or body.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ curl -XPOST http://localhost:9090/api/v1/admin/tsdb/clean_tombstones</span><br></pre></td></tr></table></figure>
<p><em>New in v2.1 and supports PUT from v2.9</em></p>
<h3 id="Remote-Write-Receiver"><a href="#Remote-Write-Receiver" class="headerlink" title="Remote Write Receiver"></a>Remote Write Receiver</h3><p>Prometheus can be configured as a receiver for the Prometheus remote write protocol. This is not considered an efficient way of ingesting samples. Use it with caution for specific low-volume use cases. It is not suitable for replacing the ingestion via scraping and turning Prometheus into a push-based metrics collection system.</p>
<p>Enable the remote write receiver by setting <code>--web.enable-remote-write-receiver</code>. When enabled, the remote write receiver endpoint is <code>/api/v1/write</code>. Find more details <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/storage/#overview">here</a>.</p>
<p><em>New in v2.33</em></p>
<h2 id="Remote-Read-API"><a href="#Remote-Read-API" class="headerlink" title="Remote Read API"></a>Remote Read API</h2><p>This is not currently considered part of the stable API and is subject to change even between non-major version releases of Prometheus.</p>
<h3 id="Format-overview-1"><a href="#Format-overview-1" class="headerlink" title="Format overview"></a>Format overview</h3><p>The API response format is JSON. Every successful API request returns a <code>2xx</code> status code.</p>
<p>Invalid requests that reach the API handlers return a JSON error object and one of the following HTTP response codes:</p>
<ul>
<li><code>400 Bad Request</code> when parameters are missing or incorrect.</li>
<li><code>422 Unprocessable Entity</code> when an expression can’t be executed (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://tools.ietf.org/html/rfc4918#page-78">RFC4918</a>).</li>
<li><code>503 Service Unavailable</code> when queries time out or abort.</li>
</ul>
<p>Other non-<code>2xx</code> codes may be returned for errors occurring before the API endpoint is reached.</p>
<p>An array of warnings may be returned if there are errors that do not inhibit the request execution. All of the data that was successfully collected will be returned in the data field.</p>
<p>The JSON response envelope format is as follows:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;status&quot;: &quot;success&quot; | &quot;error&quot;,</span><br><span class="line">  &quot;data&quot;: &lt;data&gt;,</span><br><span class="line"></span><br><span class="line">  // Only set if status is &quot;error&quot;. The data field may still hold</span><br><span class="line">  // additional data.</span><br><span class="line">  &quot;errorType&quot;: &quot;&lt;string&gt;&quot;,</span><br><span class="line">  &quot;error&quot;: &quot;&lt;string&gt;&quot;,</span><br><span class="line"></span><br><span class="line">  // Only if there were warnings while executing the request.</span><br><span class="line">  // There will still be data in the data field.</span><br><span class="line">  &quot;warnings&quot;: [&quot;&lt;string&gt;&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Generic placeholders are defined as follows:</p>
<ul>
<li><code>&lt;rfc3339 | unix_timestamp&gt;</code>: Input timestamps may be provided either in <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.ietf.org/rfc/rfc3339.txt">RFC3339</a> format or as a Unix timestamp in seconds, with optional decimal places for sub-second precision. Output timestamps are always represented as Unix timestamps in seconds.</li>
<li><code>&lt;series_selector&gt;</code>: Prometheus <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/basics/#time-series-selectors">time series selectors</a> like <code>http_requests_total</code> or <code>http_requests_total&#123;method=~&quot;(GET|POST)&quot;&#125;</code> and need to be URL-encoded.</li>
<li><code>&lt;duration&gt;</code>: <a target="_blank" rel="noopener external nofollow noreferrer" href="https://prometheus.io/docs/prometheus/latest/querying/basics/#time_durations">Prometheus duration strings</a>. For example, <code>5m</code> refers to a duration of 5 minutes.</li>
<li><code>&lt;bool&gt;</code>: boolean values (strings <code>true</code> and <code>false</code>).</li>
</ul>
<p>Note: Names of query parameters that may be repeated end with <code>[]</code>.</p>
<h3 id="Remote-Read-API-1"><a href="#Remote-Read-API-1" class="headerlink" title="Remote Read API"></a>Remote Read API</h3><p>This API provides data read functionality from Prometheus. This interface expects <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/google/snappy">snappy</a> compression. The API definition is located <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/prometheus/prometheus/blob/master/prompb/remote.proto">here</a>.</p>
<p>Request are made to the following endpoint. <code>/api/v1/read</code></p>
<h4 id="Samples"><a href="#Samples" class="headerlink" title="Samples"></a>Samples</h4><p>This returns a message that includes a list of raw samples.</p>
<h4 id="Streamed-Chunks"><a href="#Streamed-Chunks" class="headerlink" title="Streamed Chunks"></a>Streamed Chunks</h4><p>These streamed chunks utilize an XOR algorithm inspired by the <a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.vldb.org/pvldb/vol8/p1816-teller.pdf">Gorilla</a> compression to encode the chunks. However, it provides resolution to the millisecond instead of to the second.</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" rel="external nofollow noreferrer">Gallifrey</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://gallifrey.asia/posts/278d3938691c/">https://gallifrey.asia/posts/278d3938691c/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://gallifrey.asia" target="_blank">Gallifrey的计算机学习日记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Prometheus/">Prometheus</a></div><div class="post_share"><div class="social-share" data-image="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/images/wechatreward.webp" target="_blank"><img class="post-qr-code-img" src="/images/wechatreward.webp" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/images/alipay.webp" target="_blank"><img class="post-qr-code-img" src="/images/alipay.webp" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/shizi.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Gallifrey</div><div class="author-info__description"></div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">85</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/gallifreyCar"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/gallifreyCar" rel="external nofollow noreferrer" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:956465331@qq.com" rel="external nofollow noreferrer" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/images/wechat.webp" target="_blank" title="Wechat"><i class="fa-brands fa-weixin"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">该站点还在修建中ing...</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">声明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">2.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.2.</span> <span class="toc-text">示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E8%AF%AD%E8%A8%80%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">2.3.</span> <span class="toc-text">表达式语言数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E9%9D%A2%E9%87%8F-Literals"><span class="toc-number">2.4.</span> <span class="toc-text">字面量(Literals)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E9%9D%A2%E9%87%8F-String-literals"><span class="toc-number">2.4.1.</span> <span class="toc-text">字符串字面量(String literals)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E5%AD%97%E9%9D%A2%E9%87%8F-Float-literals"><span class="toc-number">2.4.2.</span> <span class="toc-text">浮点字面量(Float literals)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Time-series-Selectors"><span class="toc-number">2.5.</span> <span class="toc-text">Time series Selectors</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instant-vector-selectors"><span class="toc-number">2.5.1.</span> <span class="toc-text">Instant vector selectors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Range-Vector-Selectors"><span class="toc-number">2.5.2.</span> <span class="toc-text">Range Vector Selectors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Time-Durations"><span class="toc-number">2.5.3.</span> <span class="toc-text">Time Durations</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Offset-modifier"><span class="toc-number">2.5.4.</span> <span class="toc-text">Offset modifier</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#modifier"><span class="toc-number">2.5.5.</span> <span class="toc-text">@ modifier</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Subquery"><span class="toc-number">2.6.</span> <span class="toc-text">Subquery</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operators"><span class="toc-number">2.7.</span> <span class="toc-text">Operators</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Functions"><span class="toc-number">2.8.</span> <span class="toc-text">Functions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Comments"><span class="toc-number">2.9.</span> <span class="toc-text">Comments</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gotchas"><span class="toc-number">2.10.</span> <span class="toc-text">Gotchas</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Staleness"><span class="toc-number">2.10.1.</span> <span class="toc-text">Staleness</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Avoiding-slow-queries-and-overloads"><span class="toc-number">2.10.2.</span> <span class="toc-text">Avoiding slow queries and overloads</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">3.</span> <span class="toc-text">运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Binary-operators"><span class="toc-number">3.1.</span> <span class="toc-text">Binary operators</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Arithmetic-binary-operators"><span class="toc-number">3.1.1.</span> <span class="toc-text">Arithmetic binary operators</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Trigonometric-binary-operators"><span class="toc-number">3.1.2.</span> <span class="toc-text">Trigonometric binary operators</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Comparison-binary-operators"><span class="toc-number">3.1.3.</span> <span class="toc-text">Comparison binary operators</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Logical-set-binary-operators"><span class="toc-number">3.1.4.</span> <span class="toc-text">Logical&#x2F;set binary operators</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Vector-matching"><span class="toc-number">3.2.</span> <span class="toc-text">Vector matching</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Vector-matching-keywords"><span class="toc-number">3.2.1.</span> <span class="toc-text">Vector matching keywords</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Group-modifiers"><span class="toc-number">3.2.2.</span> <span class="toc-text">Group modifiers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#One-to-one-vector-matches"><span class="toc-number">3.2.3.</span> <span class="toc-text">One-to-one vector matches</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Many-to-one-and-one-to-many-vector-matches"><span class="toc-number">3.2.4.</span> <span class="toc-text">Many-to-one and one-to-many vector matches</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Aggregation-operators"><span class="toc-number">3.2.5.</span> <span class="toc-text">Aggregation operators</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Binary-operator-precedence"><span class="toc-number">3.3.</span> <span class="toc-text">Binary operator precedence</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Operators-for-native-histograms"><span class="toc-number">3.4.</span> <span class="toc-text">Operators for native histograms</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#abs"><span class="toc-number">4.1.</span> <span class="toc-text">abs()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#absent"><span class="toc-number">4.2.</span> <span class="toc-text">absent()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#absent-over-time"><span class="toc-number">4.3.</span> <span class="toc-text">absent_over_time()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ceil"><span class="toc-number">4.4.</span> <span class="toc-text">ceil()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#changes"><span class="toc-number">4.5.</span> <span class="toc-text">changes()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#clamp"><span class="toc-number">4.6.</span> <span class="toc-text">clamp()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#clamp-max"><span class="toc-number">4.7.</span> <span class="toc-text">clamp_max()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#clamp-min"><span class="toc-number">4.8.</span> <span class="toc-text">clamp_min()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#day-of-month"><span class="toc-number">4.9.</span> <span class="toc-text">day_of_month()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#day-of-week"><span class="toc-number">4.10.</span> <span class="toc-text">day_of_week()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#day-of-year"><span class="toc-number">4.11.</span> <span class="toc-text">day_of_year()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#days-in-month"><span class="toc-number">4.12.</span> <span class="toc-text">days_in_month()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delta"><span class="toc-number">4.13.</span> <span class="toc-text">delta()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deriv"><span class="toc-number">4.14.</span> <span class="toc-text">deriv()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#exp"><span class="toc-number">4.15.</span> <span class="toc-text">exp()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#floor"><span class="toc-number">4.16.</span> <span class="toc-text">floor()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#histogram-count-and-histogram-sum"><span class="toc-number">4.17.</span> <span class="toc-text">histogram_count() and histogram_sum()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#histogram-fraction"><span class="toc-number">4.18.</span> <span class="toc-text">histogram_fraction()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#histogram-quantile"><span class="toc-number">4.19.</span> <span class="toc-text">histogram_quantile()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#holt-winters"><span class="toc-number">4.20.</span> <span class="toc-text">holt_winters()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hour"><span class="toc-number">4.21.</span> <span class="toc-text">hour()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#idelta"><span class="toc-number">4.22.</span> <span class="toc-text">idelta()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#increase"><span class="toc-number">4.23.</span> <span class="toc-text">increase()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#irate"><span class="toc-number">4.24.</span> <span class="toc-text">irate()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#label-join"><span class="toc-number">4.25.</span> <span class="toc-text">label_join()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#label-replace"><span class="toc-number">4.26.</span> <span class="toc-text">label_replace()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ln"><span class="toc-number">4.27.</span> <span class="toc-text">ln()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#log2"><span class="toc-number">4.28.</span> <span class="toc-text">log2()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#log10"><span class="toc-number">4.29.</span> <span class="toc-text">log10()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#minute"><span class="toc-number">4.30.</span> <span class="toc-text">minute()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#month"><span class="toc-number">4.31.</span> <span class="toc-text">month()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#predict-linear"><span class="toc-number">4.32.</span> <span class="toc-text">predict_linear()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rate"><span class="toc-number">4.33.</span> <span class="toc-text">rate()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#resets"><span class="toc-number">4.34.</span> <span class="toc-text">resets()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#round"><span class="toc-number">4.35.</span> <span class="toc-text">round()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scalar"><span class="toc-number">4.36.</span> <span class="toc-text">scalar()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sgn"><span class="toc-number">4.37.</span> <span class="toc-text">sgn()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sort"><span class="toc-number">4.38.</span> <span class="toc-text">sort()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sort-desc"><span class="toc-number">4.39.</span> <span class="toc-text">sort_desc()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sqrt"><span class="toc-number">4.40.</span> <span class="toc-text">sqrt()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#time"><span class="toc-number">4.41.</span> <span class="toc-text">time()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#timestamp"><span class="toc-number">4.42.</span> <span class="toc-text">timestamp()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vector"><span class="toc-number">4.43.</span> <span class="toc-text">vector()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#year"><span class="toc-number">4.44.</span> <span class="toc-text">year()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lt-aggregation-gt-over-time"><span class="toc-number">4.45.</span> <span class="toc-text">&lt;aggregation&gt;_over_time()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Trigonometric-Functions"><span class="toc-number">4.46.</span> <span class="toc-text">Trigonometric Functions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">5.</span> <span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E9%80%89%E6%8B%A9"><span class="toc-number">5.1.</span> <span class="toc-text">简单的时间序列选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%90%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.2.</span> <span class="toc-text">子查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95%EF%BC%8C%E8%BF%90%E7%AE%97%E7%AC%A6%E7%AD%89"><span class="toc-number">5.3.</span> <span class="toc-text">使用方法，运算符等</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-API"><span class="toc-number">6.</span> <span class="toc-text">HTTP API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Format-overview"><span class="toc-number">6.1.</span> <span class="toc-text">Format overview</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Expression-queries"><span class="toc-number">6.2.</span> <span class="toc-text">Expression queries</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Instant-queries"><span class="toc-number">6.2.1.</span> <span class="toc-text">Instant queries</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Range-queries"><span class="toc-number">6.2.2.</span> <span class="toc-text">Range queries</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Formatting-query-expressions"><span class="toc-number">6.3.</span> <span class="toc-text">Formatting query expressions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Querying-metadata"><span class="toc-number">6.4.</span> <span class="toc-text">Querying metadata</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Finding-series-by-label-matchers"><span class="toc-number">6.4.1.</span> <span class="toc-text">Finding series by label matchers</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Getting-label-names"><span class="toc-number">6.4.2.</span> <span class="toc-text">Getting label names</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Querying-label-values"><span class="toc-number">6.4.3.</span> <span class="toc-text">Querying label values</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Querying-exemplars"><span class="toc-number">6.5.</span> <span class="toc-text">Querying exemplars</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Expression-query-result-formats"><span class="toc-number">6.6.</span> <span class="toc-text">Expression query result formats</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Range-vectors"><span class="toc-number">6.6.1.</span> <span class="toc-text">Range vectors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Instant-vectors"><span class="toc-number">6.6.2.</span> <span class="toc-text">Instant vectors</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Scalars"><span class="toc-number">6.6.3.</span> <span class="toc-text">Scalars</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Strings"><span class="toc-number">6.6.4.</span> <span class="toc-text">Strings</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Native-histograms"><span class="toc-number">6.6.5.</span> <span class="toc-text">Native histograms</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Targets"><span class="toc-number">6.7.</span> <span class="toc-text">Targets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rules"><span class="toc-number">6.8.</span> <span class="toc-text">Rules</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Alerts"><span class="toc-number">6.9.</span> <span class="toc-text">Alerts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Querying-target-metadata"><span class="toc-number">6.10.</span> <span class="toc-text">Querying target metadata</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Querying-metric-metadata"><span class="toc-number">6.11.</span> <span class="toc-text">Querying metric metadata</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Alertmanagers"><span class="toc-number">6.12.</span> <span class="toc-text">Alertmanagers</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Status"><span class="toc-number">6.13.</span> <span class="toc-text">Status</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Config"><span class="toc-number">6.13.1.</span> <span class="toc-text">Config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Flags"><span class="toc-number">6.13.2.</span> <span class="toc-text">Flags</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Runtime-Information"><span class="toc-number">6.13.3.</span> <span class="toc-text">Runtime Information</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Build-Information"><span class="toc-number">6.13.4.</span> <span class="toc-text">Build Information</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TSDB-Stats"><span class="toc-number">6.13.5.</span> <span class="toc-text">TSDB Stats</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#WAL-Replay-Stats"><span class="toc-number">6.13.6.</span> <span class="toc-text">WAL Replay Stats</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TSDB-Admin-APIs"><span class="toc-number">6.14.</span> <span class="toc-text">TSDB Admin APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Snapshot"><span class="toc-number">6.14.1.</span> <span class="toc-text">Snapshot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Delete-Series"><span class="toc-number">6.14.2.</span> <span class="toc-text">Delete Series</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Clean-Tombstones"><span class="toc-number">6.14.3.</span> <span class="toc-text">Clean Tombstones</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remote-Write-Receiver"><span class="toc-number">6.15.</span> <span class="toc-text">Remote Write Receiver</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Remote-Read-API"><span class="toc-number">7.</span> <span class="toc-text">Remote Read API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Format-overview-1"><span class="toc-number">7.1.</span> <span class="toc-text">Format overview</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Remote-Read-API-1"><span class="toc-number">7.2.</span> <span class="toc-text">Remote Read API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Samples"><span class="toc-number">7.2.1.</span> <span class="toc-text">Samples</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Streamed-Chunks"><span class="toc-number">7.2.2.</span> <span class="toc-text">Streamed Chunks</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recommend-post"><div class="item-headline"><i class="fas fa-dharmachakra"></i><span>相关推荐</span></div><div class="aside-list"><div class="aside-list-item"><div class="content"><a class="title" href="/posts/a69a82247d59/" title="Alertmanager指南">Alertmanager指南</a><time datetime="2023-04-28" title="发表于 2023-04-28">2023-04-28</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/posts/5933ab6bb941/" title="Prometheus入门指南">Prometheus入门指南</a><time datetime="2023-04-24" title="发表于 2023-04-24">2023-04-24</time></div></div><div class="aside-list-item"><div class="content"><a class="title" href="/posts/c1d3191dc73a/" title="Prometheus的自身监控">Prometheus的自身监控</a><time datetime="2023-05-16" title="发表于 2023-05-16">2023-05-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Algolia</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twilkoo-sljf-m3kv46ey3-ufovsmba.vercel.app/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.vemoji)'))
      }
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twilkoo-sljf-m3kv46ey3-ufovsmba.vercel.app/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      document.getElementById('twikoo-count').innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script async data-pjax src="/js/randombg.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start -->
  <script data-pjax src="https://cdn.jsdelivr.net/gh/Zfour/hexo-github-calendar@1.21/hexo_githubcalendar.js"></script>
  <script data-pjax>
        function GithubCalendarConfig(){
            var git_githubapiurl ="https://python-github-calendar-api-pink-mu.vercel.app/api/?gallifreycar";
            var git_color =['#ffffff', '#c8e1ff', '#79b8ff', '#2188ff', '#0366d6', '#005cc5', '#044289', '#032f62', '#05264c'];
            var git_user ="gallifreycar";
            var parent_div_git = document.getElementById('recent-posts');
            var git_div_html = '<div class="recent-post-item" style="width:100%;height:auto;padding:10px;"><div id="github_loading" style="width:10%;height:100%;margin:0 auto;display: block"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"  viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animateTransform></path></svg></div><div id="github_container"></div></div>';
            if(parent_div_git && location.pathname =='/'){
                console.log('已挂载github calendar')
                // parent_div_git.innerHTML=git_div_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",git_div_html) // 有报错，但不影响使用(支持pjax跳转)
            };
            GithubCalendar(git_githubapiurl,git_color,git_user)
        }
        if(document.getElementById('recent-posts')){
            GithubCalendarConfig()
        }
    </script>
    <style>#github_container{min-height:280px}@media screen and (max-width:650px) {#github_container{background-image:;min-height:0px}}</style>
    <style></style><script data-pjax>
  function butterfly_footer_beautify_injector_config(){
    var parent_div_git = document.getElementById('footer-wrap');
    var item_html = '<div id="workboard"></div><div id="ghbdages" style="overflow:hidden;max-height:120px;height:auto;text-align:center;margin-top:10px"><div class="swiper-wrapper"><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://hexo.io/" rel="external nofollow noreferrer" style="margin-inline:5px" title="博客框架为Hexo_v5.4.0"><img src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" rel="external nofollow noreferrer" style="margin-inline:5px" title="主题版本Butterfly_v4.0.0"><img src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" alt=""/></a><a class="github-badge" target="_blank" href="https://www.jsdelivr.com/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站使用JsDelivr为静态资源提供CDN加速"><img src="https://img.shields.io/badge/CDN-jsDelivr-orange?style=flat&amp;logo=jsDelivr" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站的评论区数据库和大部分API默认采用Vercel托管部署"><img src="https://img.shields.io/badge/Hosted-Vercel-brightgreen?style=flat&amp;logo=Vercel" alt=""/></a></div><div class="swiper-slide"><a class="github-badge" target="_blank" href="https://github.com/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站项目由Github托管"><img src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" alt=""/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20221706" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站已经在萌国备案，备案号萌ICP备20221706号"><img src="https://img.shields.io/badge/%E8%90%8CICP%E5%A4%87-20221706%E5%8F%B7-fe1384?style-flat&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+nhxg7wAAByxJREFUSInl1nlwVeUZx/HPuTckkD0kQFiCEEIUlNUCAqKoSBV1AIt1ikpVLFbLONjWGUXbmWrbweJMy7hUxbbTjsUq6KCiWEvr0kE2WVK2QCKBJCxJgEASsienfxwqMob+3Zm+f93z3vM+32f5vc9z+H9bwVcfOp/YQ+1prhhEZS1VDQzqQ1MjiQmIC5Liwm3lBWpqFimrulb/7A/067vM2IsOBZ2h8MhJQW6KMDNVsKeaizKEyUlsKueqgWJ39AMJF3QpDCNYr1SaEig/lWNX2Z1h6dH5/lVyGdVIZFf7MHo9bEfh9rCg/+8NyHlN77QTsnpQ0i2y08VK+BosfhbW0cHxqmSfFd9qW+l9Pi+5WltFdGTsOBbO5dJcdh3lN5+xff0Y2zuelXjRsyYUrjOu4BVJaavlpbWIJRBLOM+J81O95AAnTtM9vNHGknut3zdT48FutJE3koWTuG4oSXH+VsInX3B9IdcVUNfCuv08t4GjO6NspOa3BNcOXx1eOugVHQnrTMkTuyWrC/BjRZO9uPYTpw7HhTWkXcLd45l9GblpHD7NWzt5ZTMXZ/OdkTy+lvR07rmcmWffq6pn9W5e/oymfcT6kJbXHiydMyVYkL/x66n+ZMcctQfjhgxl6UIGZ3Ooltd2RIZqjqKRS0ew9cFIA1cO5urlLHuPZWsZPJiZw7gqn0VT2HCIR9+jvCQhfHPrLGyE2Hng2roBxHnmJoZnc9drbD3I6QaaWkjpSVoeu4+x5XB05qMDqCenHz37UHmcFRv54ZuMeoYrB/L0DPRgZ0WfrsXVKzPX3nYykrn3dUZl8+Q0Qox/gc/L6ZlKzxQefo+UROpa6Z4VCedkPd8YyJYHI3u5T/HAShZNQxsXZfR3pCtwRW066VEeOuIUVUf77+9jTw2pycTOJml7Je1t9EgiI5X2jkgyze1fCSSdtjhBiJCkpKyuI+5oTdAtkTCgVwrbKsl8ko6QjO40tZ67EpkpdIbRf20dkbPpPTjdwsSX6I5dJYy4hoQAaZQdDy4A1iEMI613T6LtBPXJpPakrjGqc1Y6CTFq62htJp5KRwPJKWSkU3WKiiPEEqO6xgM6oZmctJhDXYH7Z59xuCyKpK6R26ZE+ys3MWYoN1/Mc5uoqmbEQJ6fTc/ulJ3i/lUc+YIfzeKhKzjVHN31A3XRHddKSrf6/6DOV3VTcw1hVKfkxOhaPDAe1UwfwmNTqT1Drxw+nE9xNXetIjHG2vnoxoT+rNrN2Of58Rp6JZ+ldKes5kjX4G7dKuikpoERfaltYnQ/DOSS3hEAFk9lXQkLnmf7Ib65lPJT3HU1+46Tm8rYvgzKYVA2h+vQIMjvewHwdSN20MiOSmZczO4a1hSzYi77T7CiiPF5JMTZexjJ5OagkwNV9M+MnJ09nKU3smgyQ3PYWoEO4fUjii4QceJmevJuMeP6csUAln4atcbSGoqOUpjD30uZNwnpHNtN3lC+NZa1xeT34pGVTJ3PL9+Ohs6GQ8gVtHZs6VLVwZhBReGwoXvt3THM/hP0SWVnCR8f4PMjkffjB/DQS8waxpHFfFgaaeHZDRRtJn0yP5tF31ymFVJ2nN27GD66KBzca2/XEWdkUpD3Fmd4tYj0FMS54Q9UnuaDUv6yE/24ewWP/DU6N/d1fvousYEs28DyLVEvGDOAt/egmSkXv2VYn3NBfpXbua6J8hMFFvy2RHsL+57gmX+w/AN651PfEDWQzLRI+afqIqOxFDJT6Rbn9Bmad3PnTH5wIxOXkJTWGiz57hCDsyqDWVldRNzeyOh+paaPfpFKnvqQX88iZwDVx0lLJqUHbe3EkZ1Odm+yUqK2GHYKmhvIG8fyeTz9IY5x67jnFPapdPDkl6jzwEF9IDjZJlgwfbG+o2u8+g4rd7D/UYI41TXnevV5K4j2q6uESckUP8rvNrH6fUH/sRXB9AlPONMSDZ8uazwoi56JjEyvdftV88jinhf4uIzmJRQOoOYgja0RKAiIBZxpjvZH5tP0c97axcLlyBXOuWZemJTYFFbUCU+1dl3j8PGSyFhnJ7EkYcWh7/njqpep5xfzWTyZZ7dEg73xOJKiGqf3YenNLBjLTz7i539COg/OvSOYO2GFo/VRG0Zwe0YX4Ns3R7NXSCxBeM8IthXfZvGf3xCWc/kkXvg2vVP4YB/rDzC1gGlDo+50/xvs2khKPrNnzAzmTH5HbzR0fkkKro93Ab5vx9kfaGgT3lLA5EyWbRpoTdHbSreOppGJV/PwlRTksK+aZz5l6z+RLBgxaau5k2cJelTKzmRQMq0d51J8UxL+23d1TDTcj7WQllZu4YwxDo+eZc22X9mwd6gN65GIFmQzampxcMOoR1xeuMbpVoqromsXdG3+wmCiekNtfSSmiUNWu2zgap+WjlZW8X11TeNkpWwICvNfCm8u3Cmxg4PN0VdmEJw7/7+0/g32RaqCbhRecAAAAABJRU5ErkJggg==" alt=""/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站已经在工信部备案，备案号粤ICP备2022046410号-1"><img src="https://img.shields.io/badge/%E7%B2%A4ICP%E5%A4%87-2022046410%E5%8F%B7--1-e1d492?style=flat&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAABS2lUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIi8+CiA8L3JkZjpSREY+CjwveDp4bXBtZXRhPgo8P3hwYWNrZXQgZW5kPSJyIj8+nhxg7wAACNlJREFUSInF1mmMVeUdx/Hv2e+5+519mJWBYQZkGxZZxLKJqBXGoLS1iXWrmihotFXaJiTWWlsbl6q1aetWd5u0VkKjNG4YEJSlOCibDLMwM8x679z9nnPP1jcVJUxf+7z6J8+LT37/Z4VvaQhfFS8+sBXbctCDGrVTKlBUH4mxAbI9Hfj0IJLsp6paJ5/tmn20N/D0wKDRMq9F/c3M2U1/V0vDfWMFh+tv/Ig1zYPMabDImPJ52OaXO87W580KggCiiOsJOJ6I3wcNFaaeNKxrt72f2fLGu4FpJ/sDQABRzD22fH7/Yze069vGc6mrDLNIJCDik10sxz2by3VdPM87xzkP9jwPTZFRVI1YUJKH+oy7n3tbvv/P2wW/UQxRWe6w4ZJRptYLHDoCuz8v5cP92XbI762O+h6UVWHnUFbPpU0fEb2A60mMJ7MUi9b/b7UgKhiZMaIxm8YLplLMDPz8hl/EH+rs8TNlUpFf32uyZJGLPDwCiTGUyTWodTN49eUCdz2YwXb9NNcObp1X98WDoufynzMVCEKGn27ayPTWBi5ad8P5iQUkJEnFLjqM9Z+hrVX0vfDe6K2dPRWsW2bwyp9EUifSJB84gdxrkR0eRgv1o/3I4fbbprJ6scqamzVO9pffec1S5ZWY2Nfz5qEy/FqOC2Y3s3j53HMSi18VRjFPwSwg+1RfVbl115vvJrsfej7UGIsYPPGgQ7JXoO+Xx5B3dHEomyJ9x1qiQozkr95h5937aFnVyouPlgJK+Ss7Fxz64OTSxSX+LHYxT2IsRW5kbGI4oHcR0jqoqTjV9se3I7/f8rS/ClS23GxSXhph6L5d9Akm7qqZhHWBQGUJ+CWGFzcg7e7m6D3/ZuW1Ea5YKdA3EojuONi813TqNi+YPYOKUhXDtCeGL26/hakLLiEcdsaHRkRAoLRc4fJrmhnekyF0apgZowWSwwkaa+rw3f8WA1GZZsPP5JEChX8dhZTN6iU6kAcs5s+dHd183SJ0VVKL57pfw6YdRQw23aeWTns47DPTALWlRTR7kMLew6hGgYqUhWXYFFUdPZ6lUBahLA8hVcOftckfi7No7VRAAQqsX1dybfvG1qwriM9mM5mJ4e4jO5Cc01dPqixbr8tWGBQUL4vjGigEEShi+xUmZ2RiR/sJ1pbS8NkgZrKAGw0TsgQsQyFaF/nfYTGprAlMFysbA1pI3mhkR6snhGsaymYGvPyFEb9IdbUE2AzFFTwpRqCtBY0wmdER+hZW4j63gcJj38V+/ErSUZXsYBfjIZHIRW0c2Z8BskCAqN+CbBJBFnyyKjR+Ez57nBxLqpfMUeSISElMBFz6x2Q6OxzWrYjyxWVzEewioU3LCS5vQY6nMUrLwNaxXvoQ59IloFSx54PPAZtQLExVZZDxsVE8J4dn6v4JYatgbSjk0owPw7RGH2ADMo88Z7L20ip8f7gC7fAo0q4+0rt7kEQDvaghVZbiPHUHcyeXcfLjT3jmpR7AYsnSScya3UR8bARVMck7Y/cB75/X6rDf3Fg2dw2jKZm5dXGm1LuAzO5DCo9v6aT0ibco5kzOvLOP+NGTFJtDpPYeZKijk/Rn3QxsfZV7txwhX7ABiZUXBsGvIvguQApNQQva9RMmTvZ2dpVUls+tX/UD7GN/Y8Ws05w6rQF+9vyzg1vZjbvMRJhXiRSU8DpTFFe0QE8S6SfPkOkZoktrB2oAhZWrwljxOPmchiSMYOWNoxNuruFU5vWeXdsojiUon345113dBBQBmTYlTimgdB8nfPo4WjaNFgN9OMEkJ02dnadVt5ki54Esqy+bzKJltVhSPbI3iN2zCyMTeXNCuG7Omm2Zok7PR2+R7jvD8ouruHhmCrB5jVZeYxLdrTP4sr4Vtd9g4MA4qc4c+6cu5NPamfw4P59t2WrA4YdXKkASf7SFivo6PDdEPmf1fRM++zp1bH/0r4I1dD1ODtOWaW4IsvPjL7nqXhloQiSPwjjgMYkMASyGEBkjhISCQwkwzve/18AbT+pk8pVY4UacQi9y+gyZ0eRAw4qHa89LXEx1LXMSPfhDJYRb59BtlLKg2WPT2l6qYl1svtGkrLYckyA1S+t5+2ATm37WCui0LSynsckDNH5zTxAchbQtkx08hDHYiW6NgC0enHBzEZ102UDH8QORdEckjEzZrNWkRydzyx17uGnDXqbUnGZ6dRPjSY91q2TqwjFuvTxLo5Zn5Qo/pumRSFcTLQtybEhGE0fQrDhhJ0VvH2lTnnHPhGtsmWan469apERjI2MH3qN7+7MEfH6ql29CbV7PvsMG32k6yU2XDhEKyZw66eJaRdrXR7CzCcqUNC3zwgymPJRCH4KRRLINimpL14A5Y4GDeOqbsPRVcfuN7Xj44pav/hFfrNT2kr2rsqf2Ibp5pEA14ZIImUyW3t5REkkTXRGQ/DGGhtLginhqCWknQDE5hKf5UFSF9Lj020Q2ul5V1AR2hr+8vuP8Vlc2zMPRxoSjnx7XBC14sDoydahSGq7KdO/HFyrBchxCVfX4fDKp4T7SCQejYODZLrYgIqgKFsNIgQqEYob8mW6yiUyb7Z64LVK/+B85xznnJ3AWzqTzuIX46mr5wLs+UUTyIriBCjRNxguHMJIFDLEEvXEOVRWnSJ0+jCd4CJoGjoedM1CLcXQziW3nMV2TSMBeOx7vWZvPt1r+cMPzE8KunaUkFn0vNrvtqXj34c1W6gzxlEQ6naIoBahtnkMwoFMwIVzSRNguMt53Aj2s4nkSlgPoGqLkICsRNF0gl8rYWuP8+11/w/OOJDEhHPKLCIpOXmi+M9AgP+maiesLifF2T1Rn5ZNj5Lo/Qc/GcPMmhdoqlEgIGzCK4PiCmJKK68p4KfF3qYGuF0qCRUkJTzleUbvQyWRTuE5xYthxQbBs7EISAbkzUFG3VfXXbK2YFi3X/eryfKKnqVBItNjJxDzH8erddC4SqWwcN5WyTtlyO1RP/Lh3eHD76MB40swmiDVJyDLYRhpc5+ub6tse/wWKbvSQEAw1awAAAABJRU5ErkJggg==" alt=""/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow noreferrer" style="margin-inline:5px" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-d42328?style=flat&amp;logo=Claris" alt=""/></a></div></div></div><style>a.github-badge:hover:before {display:none}</style>';
    console.log('已挂载butterfly_footer_beautify')
    parent_div_git.insertAdjacentHTML("beforeend",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_footer_beautify_injector_config();
  }
  else if (epage === cpage){
    butterfly_footer_beautify_injector_config();
  }
  </script><script async src="/js/runtime.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="/js/swiperbdage_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>